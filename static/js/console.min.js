function ajax(a,b,c,d,e){$.ajax({url:a,type:"GET",headers:e,cache:!0,data:b,async:1,success:function(a){c(a)},error:function(a,b,c){d?d(a.responseText):show_message(c.message)}})}function json(a,b,c,d){$.ajax({url:a,type:"POST",dataType:"json",data:b,async:!1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function json_async(a,b,c,d){$.ajax({url:a,type:"POST",cache:!1,dataType:"json",data:b,async:1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function replaceParam(a,b,c){a=a.replace("#/","");var d="",e=(a.substring(0,a.indexOf("?")),a.substring(a.indexOf("?"),a.length)),f=0;if(a.indexOf("?")>=0){var g=e.indexOf(b+"=");g>=0?(f=e.indexOf("&",g),f>=0?(d=e.substring(g+b.length+1,f),e=a.replace(b+"="+d,b+"="+c)):(d=e.substring(g+b.length+1,e.length),e=a.replace(b+"="+d,b+"="+c))):e=a+"&"+b+"="+c}else e=a+"?"+b+"="+c;return e}function getRandID(a){void 0==a&&(a="rand-id-");for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<5;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function print(){var a=aside.is_open?aside:iframe,b=a.instance.contentWindow;b.print()}function ajax(a,b,c,d,e){$.ajax({url:a,type:"GET",headers:e,cache:!0,data:b,async:1,success:function(a){c(a)},error:function(a,b,c){d?d(a.responseText):show_message(c.message)}})}function json(a,b,c,d){$.ajax({url:a,type:"POST",dataType:"json",data:b,async:!1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function json_async(a,b,c,d){$.ajax({url:a,type:"POST",cache:!1,dataType:"json",data:b,async:1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function replaceParam(a,b,c){a=a.replace("#/","");var d="",e=(a.substring(0,a.indexOf("?")),a.substring(a.indexOf("?"),a.length)),f=0;if(a.indexOf("?")>=0){var g=e.indexOf(b+"=");g>=0?(f=e.indexOf("&",g),f>=0?(d=e.substring(g+b.length+1,f),e=a.replace(b+"="+d,b+"="+c)):(d=e.substring(g+b.length+1,e.length),e=a.replace(b+"="+d,b+"="+c))):e=a+"&"+b+"="+c}else e=a+"?"+b+"="+c;return e}function getRandID(a){void 0==a&&(a="rand-id-");for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<5;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function print(){var a=aside.is_open?aside:iframe,b=a.instance.contentWindow;b.print()}function ajax(a,b,c,d,e){$.ajax({url:a,type:"GET",headers:e,cache:!0,data:b,async:1,success:function(a){c(a)},error:function(a,b,c){d?d(a.responseText):show_message(c.message)}})}function json(a,b,c,d){$.ajax({url:a,type:"POST",dataType:"json",data:b,async:!1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function json_async(a,b,c,d){$.ajax({url:a,type:"POST",cache:!1,dataType:"json",data:b,async:1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function replaceParam(a,b,c){a=a.replace("#/","");var d="",e=(a.substring(0,a.indexOf("?")),a.substring(a.indexOf("?"),a.length)),f=0;if(a.indexOf("?")>=0){var g=e.indexOf(b+"=");g>=0?(f=e.indexOf("&",g),f>=0?(d=e.substring(g+b.length+1,f),e=a.replace(b+"="+d,b+"="+c)):(d=e.substring(g+b.length+1,e.length),e=a.replace(b+"="+d,b+"="+c))):e=a+"&"+b+"="+c}else e=a+"?"+b+"="+c;return e}function getRandID(a){void 0==a&&(a="rand-id-");for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<5;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function print(){var a=aside.is_open?aside:iframe,b=a.instance.contentWindow;b.print()}function ajax(a,b,c,d,e){$.ajax({url:a,type:"GET",headers:e,cache:!0,data:b,async:1,success:function(a){c(a)},error:function(a,b,c){d?d(a.responseText):show_message(c.message)}})}function json(a,b,c,d){$.ajax({url:a,type:"POST",dataType:"json",data:b,async:!1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function json_async(a,b,c,d){$.ajax({url:a,type:"POST",cache:!1,dataType:"json",data:b,async:1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function replaceParam(a,b,c){a=a.replace("#/","");var d="",e=(a.substring(0,a.indexOf("?")),a.substring(a.indexOf("?"),a.length)),f=0;if(a.indexOf("?")>=0){var g=e.indexOf(b+"=");g>=0?(f=e.indexOf("&",g),f>=0?(d=e.substring(g+b.length+1,f),e=a.replace(b+"="+d,b+"="+c)):(d=e.substring(g+b.length+1,e.length),e=a.replace(b+"="+d,b+"="+c))):e=a+"&"+b+"="+c}else e=a+"?"+b+"="+c;return e}function getRandID(a){void 0==a&&(a="rand-id-");for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<5;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function print(){var a=aside.is_open?aside:iframe,b=a.instance.contentWindow;b.print()}function ajax(a,b,c,d,e){$.ajax({url:a,type:"GET",headers:e,cache:!0,data:b,async:1,success:function(a){c(a)},error:function(a,b,c){d?d(a.responseText):show_message(c.message)}})}function json(a,b,c,d){$.ajax({url:a,type:"POST",dataType:"json",data:b,async:!1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function json_async(a,b,c,d){$.ajax({url:a,type:"POST",cache:!1,dataType:"json",data:b,async:1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function replaceParam(a,b,c){a=a.replace("#/","");var d="",e=(a.substring(0,a.indexOf("?")),a.substring(a.indexOf("?"),a.length)),f=0;if(a.indexOf("?")>=0){var g=e.indexOf(b+"=");g>=0?(f=e.indexOf("&",g),f>=0?(d=e.substring(g+b.length+1,f),e=a.replace(b+"="+d,b+"="+c)):(d=e.substring(g+b.length+1,e.length),e=a.replace(b+"="+d,b+"="+c))):e=a+"&"+b+"="+c}else e=a+"?"+b+"="+c;return e}function getRandID(a){void 0==a&&(a="rand-id-");for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<5;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function print(){var a=aside.is_open?aside:iframe,b=a.instance.contentWindow;b.print()}function ajax(a,b,c,d,e){$.ajax({url:a,type:"GET",headers:e,cache:!0,data:b,async:1,success:function(a){c(a)},error:function(a,b,c){d?d(a.responseText):show_message(c.message)}})}function json(a,b,c,d){$.ajax({url:a,type:"POST",dataType:"json",data:b,async:!1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function json_async(a,b,c,d){$.ajax({url:a,type:"POST",cache:!1,dataType:"json",data:b,async:1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function replaceParam(a,b,c){a=a.replace("#/","");var d="",e=(a.substring(0,a.indexOf("?")),a.substring(a.indexOf("?"),a.length)),f=0;if(a.indexOf("?")>=0){var g=e.indexOf(b+"=");g>=0?(f=e.indexOf("&",g),f>=0?(d=e.substring(g+b.length+1,f),e=a.replace(b+"="+d,b+"="+c)):(d=e.substring(g+b.length+1,e.length),e=a.replace(b+"="+d,b+"="+c))):e=a+"&"+b+"="+c}else e=a+"?"+b+"="+c;return e}function getRandID(a){void 0==a&&(a="rand-id-");for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<5;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function print(){var a=aside.is_open?aside:iframe,b=a.instance.contentWindow;b.print()}function ajax(a,b,c,d,e){$.ajax({url:a,type:"GET",headers:e,cache:!0,data:b,async:1,success:function(a){c(a)},error:function(a,b,c){d?d(a.responseText):show_message(c.message)}})}function json(a,b,c,d){$.ajax({url:a,type:"POST",dataType:"json",data:b,async:!1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function json_async(a,b,c,d){$.ajax({url:a,type:"POST",cache:!1,dataType:"json",data:b,async:1,success:function(a){c(a)},error:function(a,b,c){void 0==d?show_message(c.message):d(c.message)}})}function replaceParam(a,b,c){a=a.replace("#/","");var d="",e=(a.substring(0,a.indexOf("?")),a.substring(a.indexOf("?"),a.length)),f=0;if(a.indexOf("?")>=0){var g=e.indexOf(b+"=");g>=0?(f=e.indexOf("&",g),f>=0?(d=e.substring(g+b.length+1,f),e=a.replace(b+"="+d,b+"="+c)):(d=e.substring(g+b.length+1,e.length),e=a.replace(b+"="+d,b+"="+c))):e=a+"&"+b+"="+c}else e=a+"?"+b+"="+c;return e}function getRandID(a){void 0==a&&(a="rand-id-");for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<5;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function print(){var a=aside.is_open?aside:iframe,b=a.instance.contentWindow;b.print()}var progress_bar={dom:$(".progress-bar"),set:function(a){setTimeout(function(){progress_bar.dom.width(a+"%")},0),100==a&&setTimeout(function(){progress_bar.dom.width(0)},2500)}},affix=function(a){a>=25?$("header.header").addClass("affix"):$("header.header").removeClass("affix")},consoleDOD=function(a){a.preventDefault(),a.stopPropagation(),iframe.focus()},message={list:[],snackbarText:1,quick_show:function(a,b){void 0!==b?swal({title:"",html:a,timer:b,showConfirmButton:!1}).done():swal(a).done()},quick_info:function(a,b){$("body").snackbar({alive:b,content:a,show:function(){message.snackbarText++}})},showAll:function(a){$(a).find(".alert").each(function(){var a="info",b=$(this);b.hasClass("alert-info")&&(a="info"),b.hasClass("alert-warning")&&(a="warning"),b.hasClass("alert-success")&&(a="success"),b.hasClass("alert-danger")&&(a="danger"),message.insert(a,b.data("title"),b.html(),b.data("image"))})},ui:{show:function(a){$(".alert-moment").each(function(){var a=$(this).data("create");$(this).text(moment(a).fromNow())}),$(".msg").length>25&&$(".msg").last().remove(),void 0!=a&&1==a&&(clearTimeout(message.ui.hideTimer),message.ui.hideTimerCount=5,message.ui.hideAuto())},hideAuto:function(){message.ui.hideTimerCount=parseInt(message.ui.hideTimerCount)-1,message.ui.hideTimerCount<=0?message.ui.hide():message.ui.hideTimer=setTimeout(message.ui.hideAuto,1e3)},hide:function(){$("#message-box").parent("li").removeClass("open"),message.ui.hideTimerCount=0}},insert:function(a,b,c,d,e){var f=getRandID("message-");return void 0!=c&&""!=c&&message.list.push({kind:a,title:b,text:c,image:d,message_id:f,mini:e}),f},change:function(a,b,c,d,e,f){message.list.push({kind:b,title:c,text:d,image:e,message_id:a,mini:f})},afterInsert:function(){if(message.list.length>0){var a=message.list.pop();if(void 0!=a&&""!=a.text){var b="",c="",d="";switch(a.kind){case"info":c='<i class="glyphicon glyphicon-bullhorn"></i>',b="訊息";break;case"warning":c='<i class="glyphicon glyphicon-bell"></i>',b="注意";break;case"danger":c='<i class="glyphicon glyphicon-info-sign"></i>',b="錯誤";break;case"success":c='<i class="glyphicon glyphicon-ok"></i>',b="成功"}void 0!=a.image&&""!=a.image?(c='<i class="glyphicon"></i>',d="url("+a.image+")"):d="none",void 0!=a.title&&""!=a.title&&(b=a.title);var e="#"+a.message_id;if(0==$(e).length){var f='<a class="tile waves-attach" id="'+a.message_id+'" href="javascript:void(0)"><div class="tile-side pull-left"><div class="avatar avatar-sm"><div class="alert-tag" style="background-size: cover;"></div></div></div><div class="tile-inner text-black"><span class="alert-moment"></span><span class="alert-title"></span><span class="alert-text"></span></div></a>';$("#message-box").prepend(f)}$(e).find(".alert-tag").html(c).removeClass("alert-info alert-warning alert-danger alert-success").addClass("alert-"+a.kind).css("background-image",d),$(e).find(".alert-moment").data("create",moment().format()),$(e).find(".alert-title").text(b),$(e).find(".alert-text").html(a.text),$("#message-count").text($("#message-box li").length-1);var g=!1;void 0!=a.mini&&1==a.mini&&(g=a.mini),0==g&&message.ui.show(!0)}}}};Object.defineProperty(message.list,"push",{configurable:!1,enumerable:!1,writable:!1,value:function(){for(var a=0,b=this.length,c=arguments.length;a<c;a++,b++)this[b]=arguments[a],message.afterInsert();return b}});var uploader={init:function(){$(document).on("change","#image-file-picker",function(){uploader.startUpload()})},pickup_target:null,pickup_target_is_editor:!1,pickup:function(a,b){uploader.pickup_target=a,uploader.pickup_target_is_editor=b,a.hasClass("image")?$("#image-file-picker").attr("accept","image/*"):$("#image-file-picker").attr("accept","*"),$("#image-file-picker").click()},startUpload:function(){var a=document.getElementById("image-file-picker"),b=a.files[0];uploader.addFile(b,uploader.pickup_target,function(a){var b=a.response.url,c=a.response.item.__key__;uploader.pickup_target_is_editor?uploader.pickup_target.selection.setContent('<img src="'+b+'" />'):uploader.pickup_target.val(b).data("key",c).change(),$("#image-file-picker").val("")})},addFile:function(a,b,c){progress_bar.set(10);var d=message.insert("info","準備上傳","等待中....",void 0,!0);json_async("/admin/user_file/get.json",null,function(e){progress_bar.set(20),uploader.upload({message_id:d,upload_url:e.url,file:a,target_id:b,callback:c})},function(a){progress_bar.set(0),message.change(d,"danger","發生錯誤","無法取得上傳的路徑，請稍候再試一次")})},upload:function(upload_target){var reader=new FileReader;reader.reader_info=upload_target,reader.readAsDataURL(upload_target.file),reader.onload=function(e){this.reader_info.image=this.result,progress_bar.set(30),message.change(this.reader_info.message_id,"info","正在上傳","等待中....",this.reader_info.image,!0);var fd=new FormData,xhr=new XMLHttpRequest;xhr.xhr_info=this.reader_info,xhr.upload.upload_info=this.reader_info,xhr.open("POST",this.reader_info.upload_url),xhr.onload=function(data){progress_bar.set(100),message.quick_info("上傳完成"),message.change(this.xhr_info.message_id,"success","上傳完成","100 %, 上傳完成",this.xhr_info.image,!0),"function"==typeof this.xhr_info.callback&&(eval("var a = "+data.currentTarget.response),this.xhr_info.callback({response:a,target_id:this.xhr_info.target_id}))},xhr.onerror=function(a){message.change(this.xhr_info.message_id,"danger","上傳失敗","請重整頁面後再試一次",this.xhr_info.image,!0),progress_bar.set(0)},xhr.upload.onprogress=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100|0;100==b&&(b=99.9);var c=this;setTimeout(function(){message.change(c.upload_info.message_id,"info","正在上傳",b+" %",c.upload_info.image,!0)},0),progress_bar.set(b)}},fd.append("name",this.reader_info.file.name),fd.append("content_type",this.reader_info.file.type),fd.append("file",this.reader_info.file),xhr.send(fd)},/image\/\w+/.test(upload_target.file.type)}},iframe={instance:null,history:{},last_url:null,need_focus:!1,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){if(!this.is_init){this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("iframe"),window.onpopstate=this.popState,this.history=JSON.parse(localStorage.getItem("iframe.history")),null!=this.history&&"null"!=this.history||(this.history=[]);var b=$("a[target=content_iframe]");b.click(function(a){var b=$(this).find(".icon").text()?$(this).find(".icon").length>0:"",c=$(this).text().replace(b,"").trim();$(this).hasClass("main-link")&&aside.closeUi(),iframe.load($(this).attr("href"),c),a.preventDefault()});var c=$("body").data("dashboard-name");if(window.location.hash){var d=!1,e=window.location.hash.replace("#","");if(b.each(function(){$(this).attr("href")==e&&(d=!0,$(this).click())}),0==d){var f=this.getState(e);if(null!=f)iframe.load(e,f.text,f.referer_page);else{var g=e.split("/").slice(0,3).join("/");b.each(function(){$(this).attr("href")==g&&(d=!0,$(this).click())})}}0==d&&iframe.load("/"+c+"/welcome","Welcome")}else iframe.load("/"+c+"/welcome","Welcome");$(".content").hover(function(){},function(){setTimeout(function(){0==iframe.need_focus&&$(".iframe_mask").show()},800)}),$(".iframe_mask").hover(iframe.focus,function(){iframe.need_focus=!1}).mouseover(iframe.focus).mouseenter(iframe.focus).click(iframe.focus)}},focus:function(){$(".iframe_mask").hide(),iframe.need_focus=!0,iframe.instance.contentWindow.focus();var a=null;try{a=$(this.instance).contents()}catch(b){a=this.instance.contents()}a.find("body").click()},removeMask:function(){iframe.need_focus=!0,$(".iframe_mask").hide()},reload:function(a){a&&1==a||aside.closeUi();var b=this.getState();null!=b&&iframe.load(b.href,b.text,b.referer_page)},getUrl:function(){return this.last_url},load:function(a,b,c){return affix(0),1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){iframe.instance.contentWindow.showTimeout()},25e3),this.last_url=a,this.pushState(a,b,c),void iframe.instance.contentWindow.showLoading(function(){ajax(a,null,function(a){var b=iframe.getState();b&&history.pushState(b,b.text,"#"+b.href),clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a)},function(a){return clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a),!1},{is_ajax:"true"})}))},addClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").addClass(a)},removeClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").removeClass(a)},getState:function(a){return"undefined"==typeof a&&(a=iframe.getUrl()),a in this.history?iframe.history[a]:null},pushState:function(a,b,c){var d=this.getState(c);d&&d.referer_page&&(c=d.referer_page);var e=null;return a in this.history?(e=iframe.history[a],e.last_date=Date.now(),e.visit?e.visit++:e.visit=1,localStorage.setItem("iframe.history",JSON.stringify(this.history)),!1):(this.history[a]={href:a,text:b,visit:1,last_date:Date.now(),referer_page:c},void localStorage.setItem("iframe.history",JSON.stringify(this.history)))},popState:function(a){var b=a.state;b&&(iframe.load(b.href,b.text,b.is_list),window.history.replaceState(b,b.text,"#"+b.href))},search:function(a){var b="",c=this.last_url;void 0!=a&&""!=a&&(b=replaceParam(c,"query",a),b=replaceParam(b,"cursor",""),b=b.replace("?cursor=none","?"),b=b.replace("&cursor=none",""),this.load(b)),""==a&&(b=replaceParam(c,"query",""),b=b.replace("query=",""),this.load(b))}},aside={instance:null,is_open:!1,last_url:null,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){this.is_init||(this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("aside"),$(window).resize(function(){$("#aside_iframe.open").stop().animate({width:$(window).width()<992?"100%":"52%"},200)}))},load:function(a){return 1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){aside.loading_lock=!1,aside.instance.contentWindow.showTimeout()},25e4),this.last_url=a,void(this.is_open?aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}):(aside.showUi(),aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}))))},reload:function(){this.load(this.last_url)},runAjax:function(a){var b={is_ajax:"true",aside:"aside"};ajax(a,null,function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},b)},showUi:function(a){$("#aside_iframe").stop().animate({width:$(window).width()<992?"100%":"52%"},500,function(){aside.is_open=!0,"function"==typeof a&&a(),$(this).addClass("open")})},closeUi:function(a){$("#aside_iframe").stop().animate({width:"0"},500,function(){aside.is_open=!1,"function"==typeof a&&a(),$(this).removeClass("open")})}},shortcut={keys:"ctrl+r, `, ctrl+s, ctrl+shift+s, ctrl+p, esc, f5, ctrl+f5, alt+s, alt+1, alt+2, alt+3, alt+4, alt+5, alt+6, alt+7, alt+8, alt+9, /, shift+/",timer:null,lock:!1,init:function(){var a=[],b=1;$(".op-mode a").each(function(){a.push($(this).data("view-key")),a.push(b.toString()),b++}),shortcut.keys+=", "+a.join(", "),console.log(shortcut.keys),key.filter=function(a){var b=(a.target||a.srcElement).tagName;return key.setScope(/^(INPUT|TEXTAREA|SELECT)$/.test(b)?"input":"doc"),!0},key(shortcut.keys,"doc",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)}),key(shortcut.keys,"input",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)})},catchEvent:function(a,b,c){var d=aside.is_open?aside:iframe,e=d.instance.contentWindow;switch(console.log(a,b,c),b){case"ctrl+p":e.print();break;case"f5":case"ctrl+r":case"ctrl+f5":d.reload()}if(aside.is_open)switch(b){case"ctrl+shift+s":e.save_and_exit();break;case"ctrl+s":e.save_form();break;case"alt+1":case"alt+2":case"alt+3":case"alt+4":case"alt+5":case"alt+6":case"alt+7":case"alt+8":case"alt+9":e.change_lang(parseInt(b.replace("alt+",""))-1)}if("input"!=c){var f=1;switch($(".op-mode a").each(function(){b!=$(this).data("view-key")&&b!=f.toString()||view.change($(this).data("view")),f++}),b){case"/":return ui.showSearchBox(),!1;case"shift+/":console.log("help");break;case"alt+s":$("body").toggleClass("sortTag");break;case"`":aside.is_open?aside.closeUi():aside.showUi();break;case"esc":if(1==shortcut.lock)return shortcut.lock=!1,aside.closeUi(),!1;shortcut.lock=!0,clearTimeout(shortcut.timer),shortcut.timer=setTimeout(function(){shortcut.lock=!1},400)}}if("input"==c)switch(b){case"esc":return ui.closeSearchBox(),!1}if(jQuery.inArray(b,["ctrl+shift+s","ctrl+s","ctrl+r","ctrl+f5","f5","ctrl+p"])>-1)return!1}},view={current:"edit",change:function(a){""==window.name&&(this.current=a,$("body").removeClass("in-view-mode").removeClass("in-edit-mode").removeClass("in-delete-mode").removeClass("in-sort-mode").addClass("in-"+a+"-mode"),"sort"==a?iframe.addClass("in-sort-mode"):iframe.removeClass("in-sort-mode"),iframe.instance.contentWindow.changeView(),aside.is_open&&aside.instance.contentWindow.changeViewAndReload())}},ui={closeMessageBox:function(){$("header").click()},showSearchBox:function(){$("#keyword").click().focus()},closeSearchBox:function(){$(".page-overlay a").focus(),$(".page-overlay").click()},setUserInformation:function(a,b){var c=iframe.last_url;c.indexOf("/admin/application_user/%3A")>=0&&c.indexOf($("body").data("user"))>0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a)),c.indexOf("/admin/application_user/profile")>=0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a))}};$(function(){uploader.init(),shortcut.init(),$(".scrollDiv").hover(function(){$(this).addClass("on"),iframe.need_focus=!1},function(){$(this).removeClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseleave(function(){$(this).removeClass("on")}),$(".enter-sorting-mode").click(function(){view.change("sort")}),$(".enter-view-mode").click(function(){view.change("view")}),$(".enter-edit-mode").click(function(){view.change("edit")}),$(".enter-delete-mode").click(function(){view.change("delete")}),$(".page-overlay").click(function(){$("div.search-bar, .page-overlay").removeClass("on"),$("body").removeClass("on-search")}),$("#keyword").focus(function(){ui.closeMessageBox(),$("div.search-bar, .page-overlay").addClass("on"),$("body").addClass("on-search")}).keyup(function(a){13==a.which&&(a.preventDefault(),iframe.search($(this).val()))}),$(".menu-link").click(function(a){var b=$(this).attr("href");$(b).hasClass("in")?(a.stopPropagation(),a.preventDefault(),$(b).removeClass("in").animate({left:-300},function(){}),$("#main-nav").show().animate({left:0})):(a.stopPropagation(),a.preventDefault(),$("#main-nav").animate({left:-300},function(){$(this).hide()}),$(b).animate({left:0},function(){$(b).addClass("in")}))})});var progress_bar={dom:$(".progress-bar"),set:function(a){setTimeout(function(){progress_bar.dom.width(a+"%")},0),100==a&&setTimeout(function(){progress_bar.dom.width(0)},2500)}},affix=function(a){a>=25?$("header.header").addClass("affix"):$("header.header").removeClass("affix")},consoleDOD=function(a){a.preventDefault(),a.stopPropagation(),iframe.focus()},message={list:[],snackbarText:1,quick_show:function(a,b){void 0!==b?swal({title:"",html:a,timer:b,showConfirmButton:!1}).done():swal(a).done()},quick_info:function(a,b){$("body").snackbar({alive:b,content:a,show:function(){message.snackbarText++}})},showAll:function(a){$(a).find(".alert").each(function(){var a="info",b=$(this);b.hasClass("alert-info")&&(a="info"),b.hasClass("alert-warning")&&(a="warning"),b.hasClass("alert-success")&&(a="success"),b.hasClass("alert-danger")&&(a="danger"),message.insert(a,b.data("title"),b.html(),b.data("image"))})},ui:{show:function(a){$(".alert-moment").each(function(){var a=$(this).data("create");$(this).text(moment(a).fromNow())}),$(".msg").length>25&&$(".msg").last().remove(),void 0!=a&&1==a&&(clearTimeout(message.ui.hideTimer),message.ui.hideTimerCount=5,message.ui.hideAuto())},hideAuto:function(){message.ui.hideTimerCount=parseInt(message.ui.hideTimerCount)-1,message.ui.hideTimerCount<=0?message.ui.hide():message.ui.hideTimer=setTimeout(message.ui.hideAuto,1e3)},hide:function(){$("#message-box").parent("li").removeClass("open"),message.ui.hideTimerCount=0}},insert:function(a,b,c,d,e){var f=getRandID("message-");return void 0!=c&&""!=c&&message.list.push({kind:a,title:b,text:c,image:d,message_id:f,mini:e}),f},change:function(a,b,c,d,e,f){message.list.push({kind:b,title:c,text:d,image:e,message_id:a,mini:f})},afterInsert:function(){if(message.list.length>0){var a=message.list.pop();if(void 0!=a&&""!=a.text){var b="",c="",d="";switch(a.kind){case"info":c='<i class="glyphicon glyphicon-bullhorn"></i>',b="訊息";break;case"warning":c='<i class="glyphicon glyphicon-bell"></i>',b="注意";break;case"danger":c='<i class="glyphicon glyphicon-info-sign"></i>',b="錯誤";break;case"success":c='<i class="glyphicon glyphicon-ok"></i>',b="成功"}void 0!=a.image&&""!=a.image?(c='<i class="glyphicon"></i>',d="url("+a.image+")"):d="none",void 0!=a.title&&""!=a.title&&(b=a.title);var e="#"+a.message_id;if(0==$(e).length){var f='<a class="tile waves-attach" id="'+a.message_id+'" href="javascript:void(0)"><div class="tile-side pull-left"><div class="avatar avatar-sm"><div class="alert-tag" style="background-size: cover;"></div></div></div><div class="tile-inner text-black"><span class="alert-moment"></span><span class="alert-title"></span><span class="alert-text"></span></div></a>';$("#message-box").prepend(f)}$(e).find(".alert-tag").html(c).removeClass("alert-info alert-warning alert-danger alert-success").addClass("alert-"+a.kind).css("background-image",d),$(e).find(".alert-moment").data("create",moment().format()),$(e).find(".alert-title").text(b),$(e).find(".alert-text").html(a.text),$("#message-count").text($("#message-box li").length-1);var g=!1;void 0!=a.mini&&1==a.mini&&(g=a.mini),0==g&&message.ui.show(!0)}}}};Object.defineProperty(message.list,"push",{configurable:!1,enumerable:!1,writable:!1,value:function(){for(var a=0,b=this.length,c=arguments.length;a<c;a++,b++)this[b]=arguments[a],message.afterInsert();return b}});var uploader={init:function(){$(document).on("change","#image-file-picker",function(){uploader.startUpload()})},pickup_target:null,pickup_target_is_editor:!1,pickup:function(a,b){uploader.pickup_target=a,uploader.pickup_target_is_editor=b,a.hasClass("image")?$("#image-file-picker").attr("accept","image/*"):$("#image-file-picker").attr("accept","*"),$("#image-file-picker").click()},startUpload:function(){var a=document.getElementById("image-file-picker"),b=a.files[0];uploader.addFile(b,uploader.pickup_target,function(a){var b=a.response.url,c=a.response.item.__key__;uploader.pickup_target_is_editor?uploader.pickup_target.selection.setContent('<img src="'+b+'" />'):uploader.pickup_target.val(b).data("key",c).change(),$("#image-file-picker").val("")})},addFile:function(a,b,c){progress_bar.set(10);var d=message.insert("info","準備上傳","等待中....",void 0,!0);json_async("/admin/user_file/get.json",null,function(e){progress_bar.set(20),uploader.upload({message_id:d,upload_url:e.url,file:a,target_id:b,callback:c})},function(a){progress_bar.set(0),message.change(d,"danger","發生錯誤","無法取得上傳的路徑，請稍候再試一次")})},upload:function(upload_target){var reader=new FileReader;reader.reader_info=upload_target,reader.readAsDataURL(upload_target.file),reader.onload=function(e){this.reader_info.image=this.result,progress_bar.set(30),message.change(this.reader_info.message_id,"info","正在上傳","等待中....",this.reader_info.image,!0);var fd=new FormData,xhr=new XMLHttpRequest;xhr.xhr_info=this.reader_info,xhr.upload.upload_info=this.reader_info,xhr.open("POST",this.reader_info.upload_url),xhr.onload=function(data){progress_bar.set(100),message.quick_info("上傳完成"),message.change(this.xhr_info.message_id,"success","上傳完成","100 %, 上傳完成",this.xhr_info.image,!0),"function"==typeof this.xhr_info.callback&&(eval("var a = "+data.currentTarget.response),this.xhr_info.callback({response:a,target_id:this.xhr_info.target_id}))},xhr.onerror=function(a){message.change(this.xhr_info.message_id,"danger","上傳失敗","請重整頁面後再試一次",this.xhr_info.image,!0),progress_bar.set(0)},xhr.upload.onprogress=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100|0;100==b&&(b=99.9);var c=this;setTimeout(function(){message.change(c.upload_info.message_id,"info","正在上傳",b+" %",c.upload_info.image,!0)},0),progress_bar.set(b)}},fd.append("name",this.reader_info.file.name),fd.append("content_type",this.reader_info.file.type),fd.append("file",this.reader_info.file),xhr.send(fd)},/image\/\w+/.test(upload_target.file.type)}},iframe={instance:null,history:{},last_url:null,need_focus:!1,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){if(!this.is_init){this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("iframe"),window.onpopstate=this.popState,this.history=JSON.parse(localStorage.getItem("iframe.history")),null!=this.history&&"null"!=this.history||(this.history=[]);var b=$("a[target=content_iframe]");b.click(function(a){var b=$(this).find(".icon").text()?$(this).find(".icon").length>0:"",c=$(this).text().replace(b,"").trim();$(this).hasClass("main-link")&&aside.closeUi(),iframe.load($(this).attr("href"),c),a.preventDefault()});var c=$("body").data("dashboard-name");if(window.location.hash){var d=!1,e=window.location.hash.replace("#","");if(b.each(function(){$(this).attr("href")==e&&(d=!0,$(this).click())}),0==d){var f=this.getState(e);if(null!=f)iframe.load(e,f.text,f.referer_page);else{var g=e.split("/").slice(0,3).join("/");b.each(function(){$(this).attr("href")==g&&(d=!0,$(this).click())})}}0==d&&iframe.load("/"+c+"/welcome","Welcome")}else iframe.load("/"+c+"/welcome","Welcome");$(".content").hover(function(){},function(){setTimeout(function(){0==iframe.need_focus&&$(".iframe_mask").show()},800)}),$(".iframe_mask").hover(iframe.focus,function(){iframe.need_focus=!1}).mouseover(iframe.focus).mouseenter(iframe.focus).click(iframe.focus)}},focus:function(){$(".iframe_mask").hide(),iframe.need_focus=!0,iframe.instance.contentWindow.focus();var a=null;try{a=$(this.instance).contents()}catch(b){a=this.instance.contents()}a.find("body").click()},removeMask:function(){iframe.need_focus=!0,$(".iframe_mask").hide()},reload:function(a){a&&1==a||aside.closeUi();var b=this.getState();null!=b&&iframe.load(b.href,b.text,b.referer_page)},getUrl:function(){return this.last_url},load:function(a,b,c){return affix(0),1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){iframe.instance.contentWindow.showTimeout()},25e3),this.last_url=a,this.pushState(a,b,c),void iframe.instance.contentWindow.showLoading(function(){ajax(a,null,function(a){var b=iframe.getState();b&&history.pushState(b,b.text,"#"+b.href),clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a)},function(a){return clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a),!1},{is_ajax:"true"})}))},addClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").addClass(a)},removeClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents();
}b.find("body").removeClass(a)},getState:function(a){return"undefined"==typeof a&&(a=iframe.getUrl()),a in this.history?iframe.history[a]:null},pushState:function(a,b,c){var d=this.getState(c);d&&d.referer_page&&(c=d.referer_page);var e=null;return a in this.history?(e=iframe.history[a],e.last_date=Date.now(),e.visit?e.visit++:e.visit=1,localStorage.setItem("iframe.history",JSON.stringify(this.history)),!1):(this.history[a]={href:a,text:b,visit:1,last_date:Date.now(),referer_page:c},void localStorage.setItem("iframe.history",JSON.stringify(this.history)))},popState:function(a){var b=a.state;b&&(iframe.load(b.href,b.text,b.is_list),window.history.replaceState(b,b.text,"#"+b.href))},search:function(a){var b="",c=this.last_url;void 0!=a&&""!=a&&(b=replaceParam(c,"query",a),b=replaceParam(b,"cursor",""),b=b.replace("?cursor=none","?"),b=b.replace("&cursor=none",""),this.load(b)),""==a&&(b=replaceParam(c,"query",""),b=b.replace("query=",""),this.load(b))}},aside={instance:null,is_open:!1,last_url:null,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){this.is_init||(this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("aside"),$(window).resize(function(){$("#aside_iframe.open").stop().animate({width:$(window).width()<992?"100%":"52%"},200)}))},load:function(a){return 1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){aside.loading_lock=!1,aside.instance.contentWindow.showTimeout()},25e4),this.last_url=a,void(this.is_open?aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}):(aside.showUi(),aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}))))},reload:function(){this.load(this.last_url)},runAjax:function(a){var b={is_ajax:"true",aside:"aside"};ajax(a,null,function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},b)},showUi:function(a){$("#aside_iframe").stop().animate({width:$(window).width()<992?"100%":"52%"},500,function(){aside.is_open=!0,"function"==typeof a&&a(),$(this).addClass("open")})},closeUi:function(a){$("#aside_iframe").stop().animate({width:"0"},500,function(){aside.is_open=!1,"function"==typeof a&&a(),$(this).removeClass("open")})}},shortcut={keys:"ctrl+r, `, ctrl+s, ctrl+shift+s, ctrl+p, esc, f5, ctrl+f5, alt+s, alt+1, alt+2, alt+3, alt+4, alt+5, alt+6, alt+7, alt+8, alt+9, /, shift+/",timer:null,lock:!1,init:function(){var a=[],b=1;$(".op-mode a").each(function(){a.push($(this).data("view-key")),a.push(b.toString()),b++}),shortcut.keys+=", "+a.join(", "),console.log(shortcut.keys),key.filter=function(a){var b=(a.target||a.srcElement).tagName;return key.setScope(/^(INPUT|TEXTAREA|SELECT)$/.test(b)?"input":"doc"),!0},key(shortcut.keys,"doc",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)}),key(shortcut.keys,"input",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)})},catchEvent:function(a,b,c){var d=aside.is_open?aside:iframe,e=d.instance.contentWindow;switch(console.log(a,b,c),b){case"ctrl+p":e.print();break;case"f5":case"ctrl+r":case"ctrl+f5":d.reload()}if(aside.is_open)switch(b){case"ctrl+shift+s":e.save_and_exit();break;case"ctrl+s":e.save_form();break;case"alt+1":case"alt+2":case"alt+3":case"alt+4":case"alt+5":case"alt+6":case"alt+7":case"alt+8":case"alt+9":e.change_lang(parseInt(b.replace("alt+",""))-1)}if("input"!=c){var f=1;switch($(".op-mode a").each(function(){b!=$(this).data("view-key")&&b!=f.toString()||view.change($(this).data("view")),f++}),b){case"/":return ui.showSearchBox(),!1;case"shift+/":console.log("help");break;case"alt+s":$("body").toggleClass("sortTag");break;case"`":aside.is_open?aside.closeUi():aside.showUi();break;case"esc":if(1==shortcut.lock)return shortcut.lock=!1,aside.closeUi(),!1;shortcut.lock=!0,clearTimeout(shortcut.timer),shortcut.timer=setTimeout(function(){shortcut.lock=!1},400)}}if("input"==c)switch(b){case"esc":return ui.closeSearchBox(),!1}if(jQuery.inArray(b,["ctrl+shift+s","ctrl+s","ctrl+r","ctrl+f5","f5","ctrl+p"])>-1)return!1}},view={current:"edit",change:function(a){""==window.name&&(this.current=a,$("body").removeClass("in-view-mode").removeClass("in-edit-mode").removeClass("in-delete-mode").removeClass("in-sort-mode").addClass("in-"+a+"-mode"),"sort"==a?iframe.addClass("in-sort-mode"):iframe.removeClass("in-sort-mode"),iframe.instance.contentWindow.changeView(),aside.is_open&&aside.instance.contentWindow.changeViewAndReload())}},ui={closeMessageBox:function(){$("header").click()},showSearchBox:function(){$("#keyword").click().focus()},closeSearchBox:function(){$(".page-overlay a").focus(),$(".page-overlay").click()},setUserInformation:function(a,b){var c=iframe.last_url;c.indexOf("/admin/application_user/%3A")>=0&&c.indexOf($("body").data("user"))>0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a)),c.indexOf("/admin/application_user/profile")>=0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a))}};$(function(){uploader.init(),shortcut.init(),$(".scrollDiv").hover(function(){$(this).addClass("on"),iframe.need_focus=!1},function(){$(this).removeClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseleave(function(){$(this).removeClass("on")}),$(".enter-sorting-mode").click(function(){view.change("sort")}),$(".enter-view-mode").click(function(){view.change("view")}),$(".enter-edit-mode").click(function(){view.change("edit")}),$(".enter-delete-mode").click(function(){view.change("delete")}),$(".page-overlay").click(function(){$("div.search-bar, .page-overlay").removeClass("on"),$("body").removeClass("on-search")}),$("#keyword").focus(function(){ui.closeMessageBox(),$("div.search-bar, .page-overlay").addClass("on"),$("body").addClass("on-search")}).keyup(function(a){13==a.which&&(a.preventDefault(),iframe.search($(this).val()))}),$(".menu-link").click(function(a){var b=$(this).attr("href");$(b).hasClass("in")?(a.stopPropagation(),a.preventDefault(),$(b).removeClass("in").animate({left:-300},function(){}),$("#main-nav").show().animate({left:0})):(a.stopPropagation(),a.preventDefault(),$("#main-nav").animate({left:-300},function(){$(this).hide()}),$(b).animate({left:0},function(){$(b).addClass("in")}))})});var progress_bar={dom:$(".progress-bar"),set:function(a){setTimeout(function(){progress_bar.dom.width(a+"%")},0),100==a&&setTimeout(function(){progress_bar.dom.width(0)},2500)}},affix=function(a){a>=25?$("header.header").addClass("affix"):$("header.header").removeClass("affix")},consoleDOD=function(a){a.preventDefault(),a.stopPropagation(),iframe.focus()},message={list:[],snackbarText:1,quick_show:function(a,b){void 0!==b?swal({title:"",html:a,timer:b,showConfirmButton:!1}).done():swal(a).done()},quick_info:function(a,b){$("body").snackbar({alive:b,content:a,show:function(){message.snackbarText++}})},showAll:function(a){$(a).find(".alert").each(function(){var a="info",b=$(this);b.hasClass("alert-info")&&(a="info"),b.hasClass("alert-warning")&&(a="warning"),b.hasClass("alert-success")&&(a="success"),b.hasClass("alert-danger")&&(a="danger"),message.insert(a,b.data("title"),b.html(),b.data("image"))})},ui:{show:function(a){$(".alert-moment").each(function(){var a=$(this).data("create");$(this).text(moment(a).fromNow())}),$(".msg").length>25&&$(".msg").last().remove(),void 0!=a&&1==a&&(clearTimeout(message.ui.hideTimer),message.ui.hideTimerCount=5,message.ui.hideAuto())},hideAuto:function(){message.ui.hideTimerCount=parseInt(message.ui.hideTimerCount)-1,message.ui.hideTimerCount<=0?message.ui.hide():message.ui.hideTimer=setTimeout(message.ui.hideAuto,1e3)},hide:function(){$("#message-box").parent("li").removeClass("open"),message.ui.hideTimerCount=0}},insert:function(a,b,c,d,e){var f=getRandID("message-");return void 0!=c&&""!=c&&message.list.push({kind:a,title:b,text:c,image:d,message_id:f,mini:e}),f},change:function(a,b,c,d,e,f){message.list.push({kind:b,title:c,text:d,image:e,message_id:a,mini:f})},afterInsert:function(){if(message.list.length>0){var a=message.list.pop();if(void 0!=a&&""!=a.text){var b="",c="",d="";switch(a.kind){case"info":c='<i class="glyphicon glyphicon-bullhorn"></i>',b="訊息";break;case"warning":c='<i class="glyphicon glyphicon-bell"></i>',b="注意";break;case"danger":c='<i class="glyphicon glyphicon-info-sign"></i>',b="錯誤";break;case"success":c='<i class="glyphicon glyphicon-ok"></i>',b="成功"}void 0!=a.image&&""!=a.image?(c='<i class="glyphicon"></i>',d="url("+a.image+")"):d="none",void 0!=a.title&&""!=a.title&&(b=a.title);var e="#"+a.message_id;if(0==$(e).length){var f='<a class="tile waves-attach" id="'+a.message_id+'" href="javascript:void(0)"><div class="tile-side pull-left"><div class="avatar avatar-sm"><div class="alert-tag" style="background-size: cover;"></div></div></div><div class="tile-inner text-black"><span class="alert-moment"></span><span class="alert-title"></span><span class="alert-text"></span></div></a>';$("#message-box").prepend(f)}$(e).find(".alert-tag").html(c).removeClass("alert-info alert-warning alert-danger alert-success").addClass("alert-"+a.kind).css("background-image",d),$(e).find(".alert-moment").data("create",moment().format()),$(e).find(".alert-title").text(b),$(e).find(".alert-text").html(a.text),$("#message-count").text($("#message-box li").length-1);var g=!1;void 0!=a.mini&&1==a.mini&&(g=a.mini),0==g&&message.ui.show(!0)}}}};Object.defineProperty(message.list,"push",{configurable:!1,enumerable:!1,writable:!1,value:function(){for(var a=0,b=this.length,c=arguments.length;a<c;a++,b++)this[b]=arguments[a],message.afterInsert();return b}});var uploader={init:function(){$(document).on("change","#image-file-picker",function(){uploader.startUpload()})},pickup_target:null,pickup_target_is_editor:!1,pickup:function(a,b){uploader.pickup_target=a,uploader.pickup_target_is_editor=b,a.hasClass("image")?$("#image-file-picker").attr("accept","image/*"):$("#image-file-picker").attr("accept","*"),$("#image-file-picker").click()},startUpload:function(){var a=document.getElementById("image-file-picker"),b=a.files[0];uploader.addFile(b,uploader.pickup_target,function(a){var b=a.response.url,c=a.response.item.__key__;uploader.pickup_target_is_editor?uploader.pickup_target.selection.setContent('<img src="'+b+'" />'):uploader.pickup_target.val(b).data("key",c).change(),$("#image-file-picker").val("")})},addFile:function(a,b,c){progress_bar.set(10);var d=message.insert("info","準備上傳","等待中....",void 0,!0);json_async("/admin/user_file/get.json",null,function(e){progress_bar.set(20),uploader.upload({message_id:d,upload_url:e.url,file:a,target_id:b,callback:c})},function(a){progress_bar.set(0),message.change(d,"danger","發生錯誤","無法取得上傳的路徑，請稍候再試一次")})},upload:function(upload_target){var reader=new FileReader;reader.reader_info=upload_target,reader.readAsDataURL(upload_target.file),reader.onload=function(e){this.reader_info.image=this.result,progress_bar.set(30),message.change(this.reader_info.message_id,"info","正在上傳","等待中....",this.reader_info.image,!0);var fd=new FormData,xhr=new XMLHttpRequest;xhr.xhr_info=this.reader_info,xhr.upload.upload_info=this.reader_info,xhr.open("POST",this.reader_info.upload_url),xhr.onload=function(data){progress_bar.set(100),message.quick_info("上傳完成"),message.change(this.xhr_info.message_id,"success","上傳完成","100 %, 上傳完成",this.xhr_info.image,!0),"function"==typeof this.xhr_info.callback&&(eval("var a = "+data.currentTarget.response),this.xhr_info.callback({response:a,target_id:this.xhr_info.target_id}))},xhr.onerror=function(a){message.change(this.xhr_info.message_id,"danger","上傳失敗","請重整頁面後再試一次",this.xhr_info.image,!0),progress_bar.set(0)},xhr.upload.onprogress=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100|0;100==b&&(b=99.9);var c=this;setTimeout(function(){message.change(c.upload_info.message_id,"info","正在上傳",b+" %",c.upload_info.image,!0)},0),progress_bar.set(b)}},fd.append("name",this.reader_info.file.name),fd.append("content_type",this.reader_info.file.type),fd.append("file",this.reader_info.file),xhr.send(fd)},/image\/\w+/.test(upload_target.file.type)}},iframe={instance:null,history:{},last_url:null,need_focus:!1,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){if(!this.is_init){this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("iframe"),window.onpopstate=this.popState,this.history=JSON.parse(localStorage.getItem("iframe.history")),null!=this.history&&"null"!=this.history||(this.history=[]);var b=$("a[target=content_iframe]");b.click(function(a){var b=$(this).find(".icon").text()?$(this).find(".icon").length>0:"",c=$(this).text().replace(b,"").trim();$(this).hasClass("main-link")&&aside.closeUi(),iframe.load($(this).attr("href"),c),a.preventDefault()});var c=$("body").data("dashboard-name");if(window.location.hash){var d=!1,e=window.location.hash.replace("#","");if(b.each(function(){$(this).attr("href")==e&&(d=!0,$(this).click())}),0==d){var f=this.getState(e);if(null!=f)iframe.load(e,f.text,f.referer_page);else{var g=e.split("/").slice(0,3).join("/");b.each(function(){$(this).attr("href")==g&&(d=!0,$(this).click())})}}0==d&&iframe.load("/"+c+"/welcome","Welcome")}else iframe.load("/"+c+"/welcome","Welcome");$(".content").hover(function(){},function(){setTimeout(function(){0==iframe.need_focus&&$(".iframe_mask").show()},800)}),$(".iframe_mask").hover(iframe.focus,function(){iframe.need_focus=!1}).mouseover(iframe.focus).mouseenter(iframe.focus).click(iframe.focus)}},focus:function(){$(".iframe_mask").hide(),iframe.need_focus=!0,iframe.instance.contentWindow.focus();var a=null;try{a=$(this.instance).contents()}catch(b){a=this.instance.contents()}a.find("body").click()},removeMask:function(){iframe.need_focus=!0,$(".iframe_mask").hide()},reload:function(a){a&&1==a||aside.closeUi();var b=this.getState();null!=b&&iframe.load(b.href,b.text,b.referer_page)},getUrl:function(){return this.last_url},load:function(a,b,c){return affix(0),1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){iframe.instance.contentWindow.showTimeout()},25e3),this.last_url=a,this.pushState(a,b,c),void iframe.instance.contentWindow.showLoading(function(){ajax(a,null,function(a){var b=iframe.getState();b&&history.pushState(b,b.text,"#"+b.href),clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a)},function(a){return clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a),!1},{is_ajax:"true"})}))},addClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").addClass(a)},removeClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").removeClass(a)},getState:function(a){return"undefined"==typeof a&&(a=iframe.getUrl()),a in this.history?iframe.history[a]:null},pushState:function(a,b,c){var d=this.getState(c);d&&d.referer_page&&(c=d.referer_page);var e=null;return a in this.history?(e=iframe.history[a],e.last_date=Date.now(),e.visit?e.visit++:e.visit=1,localStorage.setItem("iframe.history",JSON.stringify(this.history)),!1):(this.history[a]={href:a,text:b,visit:1,last_date:Date.now(),referer_page:c},void localStorage.setItem("iframe.history",JSON.stringify(this.history)))},popState:function(a){var b=a.state;b&&(iframe.load(b.href,b.text,b.is_list),window.history.replaceState(b,b.text,"#"+b.href))},search:function(a){var b="",c=this.last_url;void 0!=a&&""!=a&&(b=replaceParam(c,"query",a),b=replaceParam(b,"cursor",""),b=b.replace("?cursor=none","?"),b=b.replace("&cursor=none",""),this.load(b)),""==a&&(b=replaceParam(c,"query",""),b=b.replace("query=",""),this.load(b))}},aside={instance:null,is_open:!1,last_url:null,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){this.is_init||(this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("aside"),$(window).resize(function(){$("#aside_iframe.open").stop().animate({width:$(window).width()<992?"100%":"52%"},200)}))},load:function(a){return 1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){aside.loading_lock=!1,aside.instance.contentWindow.showTimeout()},25e4),this.last_url=a,void(this.is_open?aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}):(aside.showUi(),aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}))))},reload:function(){this.load(this.last_url)},runAjax:function(a){var b={is_ajax:"true",aside:"aside"};ajax(a,null,function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},b)},showUi:function(a){$("#aside_iframe").stop().animate({width:$(window).width()<992?"100%":"52%"},500,function(){aside.is_open=!0,"function"==typeof a&&a(),$(this).addClass("open")})},closeUi:function(a){$("#aside_iframe").stop().animate({width:"0"},500,function(){aside.is_open=!1,"function"==typeof a&&a(),$(this).removeClass("open")})}},shortcut={keys:"ctrl+r, `, ctrl+s, ctrl+shift+s, ctrl+p, esc, f5, ctrl+f5, alt+s, alt+1, alt+2, alt+3, alt+4, alt+5, alt+6, alt+7, alt+8, alt+9, /, shift+/",timer:null,lock:!1,init:function(){var a=[],b=1;$(".op-mode a").each(function(){a.push($(this).data("view-key")),a.push(b.toString()),b++}),shortcut.keys+=", "+a.join(", "),console.log(shortcut.keys),key.filter=function(a){var b=(a.target||a.srcElement).tagName;return key.setScope(/^(INPUT|TEXTAREA|SELECT)$/.test(b)?"input":"doc"),!0},key(shortcut.keys,"doc",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)}),key(shortcut.keys,"input",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)})},catchEvent:function(a,b,c){var d=aside.is_open?aside:iframe,e=d.instance.contentWindow;switch(console.log(a,b,c),b){case"ctrl+p":e.print();break;case"f5":case"ctrl+r":case"ctrl+f5":d.reload()}if(aside.is_open)switch(b){case"ctrl+shift+s":e.save_and_exit();break;case"ctrl+s":e.save_form();break;case"alt+1":case"alt+2":case"alt+3":case"alt+4":case"alt+5":case"alt+6":case"alt+7":case"alt+8":case"alt+9":e.change_lang(parseInt(b.replace("alt+",""))-1)}if("input"!=c){var f=1;switch($(".op-mode a").each(function(){b!=$(this).data("view-key")&&b!=f.toString()||view.change($(this).data("view")),f++}),b){case"/":return ui.showSearchBox(),!1;case"shift+/":console.log("help");break;case"alt+s":$("body").toggleClass("sortTag");break;case"`":aside.is_open?aside.closeUi():aside.showUi();break;case"esc":if(1==shortcut.lock)return shortcut.lock=!1,aside.closeUi(),!1;shortcut.lock=!0,clearTimeout(shortcut.timer),shortcut.timer=setTimeout(function(){shortcut.lock=!1},400)}}if("input"==c)switch(b){case"esc":return ui.closeSearchBox(),!1}if(jQuery.inArray(b,["ctrl+shift+s","ctrl+s","ctrl+r","ctrl+f5","f5","ctrl+p"])>-1)return!1}},view={current:"edit",change:function(a){""==window.name&&(this.current=a,$("body").removeClass("in-view-mode").removeClass("in-edit-mode").removeClass("in-delete-mode").removeClass("in-sort-mode").addClass("in-"+a+"-mode"),"sort"==a?iframe.addClass("in-sort-mode"):iframe.removeClass("in-sort-mode"),iframe.instance.contentWindow.changeView(),aside.is_open&&aside.instance.contentWindow.changeViewAndReload())}},ui={closeMessageBox:function(){$("header").click()},showSearchBox:function(){$("#keyword").click().focus()},closeSearchBox:function(){$(".page-overlay a").focus(),$(".page-overlay").click()},setUserInformation:function(a,b){var c=iframe.last_url;c.indexOf("/admin/application_user/%3A")>=0&&c.indexOf($("body").data("user"))>0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a)),c.indexOf("/admin/application_user/profile")>=0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a))}};$(function(){uploader.init(),shortcut.init(),$(".scrollDiv").hover(function(){$(this).addClass("on"),iframe.need_focus=!1},function(){$(this).removeClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseleave(function(){$(this).removeClass("on")}),$(".enter-sorting-mode").click(function(){view.change("sort")}),$(".enter-view-mode").click(function(){view.change("view")}),$(".enter-edit-mode").click(function(){view.change("edit")}),$(".enter-delete-mode").click(function(){view.change("delete")}),$(".page-overlay").click(function(){$("div.search-bar, .page-overlay").removeClass("on"),$("body").removeClass("on-search")}),$("#keyword").focus(function(){ui.closeMessageBox(),$("div.search-bar, .page-overlay").addClass("on"),$("body").addClass("on-search")}).keyup(function(a){13==a.which&&(a.preventDefault(),iframe.search($(this).val()))}),$(".menu-link").click(function(a){var b=$(this).attr("href");$(b).hasClass("in")?(a.stopPropagation(),a.preventDefault(),$(b).removeClass("in").animate({left:-300},function(){}),$("#main-nav").show().animate({left:0})):(a.stopPropagation(),a.preventDefault(),$("#main-nav").animate({left:-300},function(){$(this).hide()}),$(b).animate({left:0},function(){$(b).addClass("in")}))})});var progress_bar={dom:$(".progress-bar"),set:function(a){setTimeout(function(){progress_bar.dom.width(a+"%")},0),100==a&&setTimeout(function(){progress_bar.dom.width(0)},2500)}},affix=function(a){a>=25?$("header.header").addClass("affix"):$("header.header").removeClass("affix")},consoleDOD=function(a){a.preventDefault(),a.stopPropagation(),iframe.focus()},message={list:[],snackbarText:1,quick_show:function(a,b){void 0!==b?swal({title:"",html:a,timer:b,showConfirmButton:!1}).done():swal(a).done()},quick_info:function(a,b){$("body").snackbar({alive:b,content:a,show:function(){message.snackbarText++}})},showAll:function(a){$(a).find(".alert").each(function(){var a="info",b=$(this);b.hasClass("alert-info")&&(a="info"),b.hasClass("alert-warning")&&(a="warning"),b.hasClass("alert-success")&&(a="success"),b.hasClass("alert-danger")&&(a="danger"),message.insert(a,b.data("title"),b.html(),b.data("image"))})},ui:{show:function(a){$(".alert-moment").each(function(){var a=$(this).data("create");$(this).text(moment(a).fromNow())}),$(".msg").length>25&&$(".msg").last().remove(),void 0!=a&&1==a&&(clearTimeout(message.ui.hideTimer),message.ui.hideTimerCount=5,message.ui.hideAuto())},hideAuto:function(){message.ui.hideTimerCount=parseInt(message.ui.hideTimerCount)-1,message.ui.hideTimerCount<=0?message.ui.hide():message.ui.hideTimer=setTimeout(message.ui.hideAuto,1e3)},hide:function(){$("#message-box").parent("li").removeClass("open"),message.ui.hideTimerCount=0}},insert:function(a,b,c,d,e){var f=getRandID("message-");return void 0!=c&&""!=c&&message.list.push({kind:a,title:b,text:c,image:d,message_id:f,mini:e}),f},change:function(a,b,c,d,e,f){message.list.push({kind:b,title:c,text:d,image:e,message_id:a,mini:f})},afterInsert:function(){if(message.list.length>0){var a=message.list.pop();if(void 0!=a&&""!=a.text){var b="",c="",d="";switch(a.kind){case"info":c='<i class="glyphicon glyphicon-bullhorn"></i>',b="訊息";break;case"warning":c='<i class="glyphicon glyphicon-bell"></i>',b="注意";break;case"danger":c='<i class="glyphicon glyphicon-info-sign"></i>',b="錯誤";break;case"success":c='<i class="glyphicon glyphicon-ok"></i>',b="成功"}void 0!=a.image&&""!=a.image?(c='<i class="glyphicon"></i>',d="url("+a.image+")"):d="none",void 0!=a.title&&""!=a.title&&(b=a.title);var e="#"+a.message_id;if(0==$(e).length){var f='<a class="tile waves-attach" id="'+a.message_id+'" href="javascript:void(0)"><div class="tile-side pull-left"><div class="avatar avatar-sm"><div class="alert-tag" style="background-size: cover;"></div></div></div><div class="tile-inner text-black"><span class="alert-moment"></span><span class="alert-title"></span><span class="alert-text"></span></div></a>';$("#message-box").prepend(f)}$(e).find(".alert-tag").html(c).removeClass("alert-info alert-warning alert-danger alert-success").addClass("alert-"+a.kind).css("background-image",d),$(e).find(".alert-moment").data("create",moment().format()),$(e).find(".alert-title").text(b),$(e).find(".alert-text").html(a.text),$("#message-count").text($("#message-box li").length-1);var g=!1;void 0!=a.mini&&1==a.mini&&(g=a.mini),0==g&&message.ui.show(!0)}}}};Object.defineProperty(message.list,"push",{configurable:!1,enumerable:!1,writable:!1,value:function(){for(var a=0,b=this.length,c=arguments.length;a<c;a++,b++)this[b]=arguments[a],message.afterInsert();return b}});var uploader={init:function(){$(document).on("change","#image-file-picker",function(){uploader.startUpload()})},pickup_target:null,pickup_target_is_editor:!1,pickup:function(a,b){uploader.pickup_target=a,uploader.pickup_target_is_editor=b,a.hasClass("image")?$("#image-file-picker").attr("accept","image/*"):$("#image-file-picker").attr("accept","*"),$("#image-file-picker").click()},startUpload:function(){var a=document.getElementById("image-file-picker"),b=a.files[0];uploader.addFile(b,uploader.pickup_target,function(a){var b=a.response.url,c=a.response.item.__key__;uploader.pickup_target_is_editor?uploader.pickup_target.selection.setContent('<img src="'+b+'" />'):uploader.pickup_target.val(b).data("key",c).change(),$("#image-file-picker").val("")})},addFile:function(a,b,c){progress_bar.set(10);var d=message.insert("info","準備上傳","等待中....",void 0,!0);json_async("/admin/user_file/get.json",null,function(e){progress_bar.set(20),uploader.upload({message_id:d,upload_url:e.url,file:a,target_id:b,callback:c})},function(a){progress_bar.set(0),message.change(d,"danger","發生錯誤","無法取得上傳的路徑，請稍候再試一次")})},upload:function(upload_target){var reader=new FileReader;reader.reader_info=upload_target,reader.readAsDataURL(upload_target.file),reader.onload=function(e){this.reader_info.image=this.result,progress_bar.set(30),message.change(this.reader_info.message_id,"info","正在上傳","等待中....",this.reader_info.image,!0);var fd=new FormData,xhr=new XMLHttpRequest;xhr.xhr_info=this.reader_info,xhr.upload.upload_info=this.reader_info,xhr.open("POST",this.reader_info.upload_url),xhr.onload=function(data){progress_bar.set(100),message.quick_info("上傳完成"),message.change(this.xhr_info.message_id,"success","上傳完成","100 %, 上傳完成",this.xhr_info.image,!0),"function"==typeof this.xhr_info.callback&&(eval("var a = "+data.currentTarget.response),this.xhr_info.callback({response:a,target_id:this.xhr_info.target_id}))},xhr.onerror=function(a){message.change(this.xhr_info.message_id,"danger","上傳失敗","請重整頁面後再試一次",this.xhr_info.image,!0),progress_bar.set(0)},xhr.upload.onprogress=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100|0;100==b&&(b=99.9);var c=this;setTimeout(function(){message.change(c.upload_info.message_id,"info","正在上傳",b+" %",c.upload_info.image,!0)},0),progress_bar.set(b)}},fd.append("name",this.reader_info.file.name),fd.append("content_type",this.reader_info.file.type),fd.append("file",this.reader_info.file),xhr.send(fd)},/image\/\w+/.test(upload_target.file.type)}},iframe={instance:null,history:{},last_url:null,need_focus:!1,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){if(!this.is_init){this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("iframe"),window.onpopstate=this.popState,this.history=JSON.parse(localStorage.getItem("iframe.history")),null!=this.history&&"null"!=this.history||(this.history=[]);var b=$("a[target=content_iframe]");b.click(function(a){var b=$(this).find(".icon").text()?$(this).find(".icon").length>0:"",c=$(this).text().replace(b,"").trim();$(this).hasClass("main-link")&&aside.closeUi(),iframe.load($(this).attr("href"),c),a.preventDefault()});var c=$("body").data("dashboard-name");if(window.location.hash){var d=!1,e=window.location.hash.replace("#","");if(b.each(function(){$(this).attr("href")==e&&(d=!0,$(this).click())}),0==d){var f=this.getState(e);if(null!=f)iframe.load(e,f.text,f.referer_page);else{var g=e.split("/").slice(0,3).join("/");b.each(function(){$(this).attr("href")==g&&(d=!0,$(this).click())})}}0==d&&iframe.load("/"+c+"/welcome","Welcome")}else iframe.load("/"+c+"/welcome","Welcome");$(".content").hover(function(){},function(){setTimeout(function(){0==iframe.need_focus&&$(".iframe_mask").show()},800)}),$(".iframe_mask").hover(iframe.focus,function(){iframe.need_focus=!1}).mouseover(iframe.focus).mouseenter(iframe.focus).click(iframe.focus)}},focus:function(){$(".iframe_mask").hide(),iframe.need_focus=!0,iframe.instance.contentWindow.focus();var a=null;try{a=$(this.instance).contents()}catch(b){a=this.instance.contents()}a.find("body").click()},removeMask:function(){iframe.need_focus=!0,$(".iframe_mask").hide()},reload:function(a){a&&1==a||aside.closeUi();var b=this.getState();null!=b&&iframe.load(b.href,b.text,b.referer_page)},getUrl:function(){return this.last_url},load:function(a,b,c){return affix(0),1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){iframe.instance.contentWindow.showTimeout()},25e3),this.last_url=a,this.pushState(a,b,c),void iframe.instance.contentWindow.showLoading(function(){ajax(a,null,function(a){var b=iframe.getState();b&&history.pushState(b,b.text,"#"+b.href),clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a)},function(a){return clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a),!1},{is_ajax:"true"})}))},addClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").addClass(a)},removeClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").removeClass(a)},getState:function(a){return"undefined"==typeof a&&(a=iframe.getUrl()),a in this.history?iframe.history[a]:null},pushState:function(a,b,c){var d=this.getState(c);d&&d.referer_page&&(c=d.referer_page);var e=null;return a in this.history?(e=iframe.history[a],e.last_date=Date.now(),e.visit?e.visit++:e.visit=1,localStorage.setItem("iframe.history",JSON.stringify(this.history)),!1):(this.history[a]={href:a,text:b,visit:1,last_date:Date.now(),referer_page:c},void localStorage.setItem("iframe.history",JSON.stringify(this.history)))},popState:function(a){var b=a.state;b&&(iframe.load(b.href,b.text,b.is_list),window.history.replaceState(b,b.text,"#"+b.href))},search:function(a){var b="",c=this.last_url;void 0!=a&&""!=a&&(b=replaceParam(c,"query",a),b=replaceParam(b,"cursor",""),b=b.replace("?cursor=none","?"),b=b.replace("&cursor=none",""),this.load(b)),""==a&&(b=replaceParam(c,"query",""),b=b.replace("query=",""),this.load(b))}},aside={instance:null,is_open:!1,last_url:null,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){this.is_init||(this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("aside"),$(window).resize(function(){$("#aside_iframe.open").stop().animate({width:$(window).width()<992?"100%":"52%"},200)}))},load:function(a){return 1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){aside.loading_lock=!1,aside.instance.contentWindow.showTimeout()},25e4),this.last_url=a,void(this.is_open?aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}):(aside.showUi(),aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}))))},reload:function(){this.load(this.last_url)},runAjax:function(a){var b={is_ajax:"true",aside:"aside"};ajax(a,null,function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a);
},b)},showUi:function(a){$("#aside_iframe").stop().animate({width:$(window).width()<992?"100%":"52%"},500,function(){aside.is_open=!0,"function"==typeof a&&a(),$(this).addClass("open")})},closeUi:function(a){$("#aside_iframe").stop().animate({width:"0"},500,function(){aside.is_open=!1,"function"==typeof a&&a(),$(this).removeClass("open")})}},shortcut={keys:"ctrl+r, `, ctrl+s, ctrl+shift+s, ctrl+p, esc, f5, ctrl+f5, alt+s, alt+1, alt+2, alt+3, alt+4, alt+5, alt+6, alt+7, alt+8, alt+9, /, shift+/",timer:null,lock:!1,init:function(){var a=[],b=1;$(".op-mode a").each(function(){a.push($(this).data("view-key")),a.push(b.toString()),b++}),shortcut.keys+=", "+a.join(", "),console.log(shortcut.keys),key.filter=function(a){var b=(a.target||a.srcElement).tagName;return key.setScope(/^(INPUT|TEXTAREA|SELECT)$/.test(b)?"input":"doc"),!0},key(shortcut.keys,"doc",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)}),key(shortcut.keys,"input",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)})},catchEvent:function(a,b,c){var d=aside.is_open?aside:iframe,e=d.instance.contentWindow;switch(console.log(a,b,c),b){case"ctrl+p":e.print();break;case"f5":case"ctrl+r":case"ctrl+f5":d.reload()}if(aside.is_open)switch(b){case"ctrl+shift+s":e.save_and_exit();break;case"ctrl+s":e.save_form();break;case"alt+1":case"alt+2":case"alt+3":case"alt+4":case"alt+5":case"alt+6":case"alt+7":case"alt+8":case"alt+9":e.change_lang(parseInt(b.replace("alt+",""))-1)}if("input"!=c){var f=1;switch($(".op-mode a").each(function(){b!=$(this).data("view-key")&&b!=f.toString()||view.change($(this).data("view")),f++}),b){case"/":return ui.showSearchBox(),!1;case"shift+/":console.log("help");break;case"alt+s":$("body").toggleClass("sortTag");break;case"`":aside.is_open?aside.closeUi():aside.showUi();break;case"esc":if(1==shortcut.lock)return shortcut.lock=!1,aside.closeUi(),!1;shortcut.lock=!0,clearTimeout(shortcut.timer),shortcut.timer=setTimeout(function(){shortcut.lock=!1},400)}}if("input"==c)switch(b){case"esc":return ui.closeSearchBox(),!1}if(jQuery.inArray(b,["ctrl+shift+s","ctrl+s","ctrl+r","ctrl+f5","f5","ctrl+p"])>-1)return!1}},view={current:"edit",change:function(a){""==window.name&&(this.current=a,$("body").removeClass("in-view-mode").removeClass("in-edit-mode").removeClass("in-delete-mode").removeClass("in-sort-mode").addClass("in-"+a+"-mode"),"sort"==a?iframe.addClass("in-sort-mode"):iframe.removeClass("in-sort-mode"),iframe.instance.contentWindow.changeView(),aside.is_open&&aside.instance.contentWindow.changeViewAndReload())}},ui={closeMessageBox:function(){$("header").click()},showSearchBox:function(){$("#keyword").click().focus()},closeSearchBox:function(){$(".page-overlay a").focus(),$(".page-overlay").click()},setUserInformation:function(a,b){var c=iframe.last_url;c.indexOf("/admin/application_user/%3A")>=0&&c.indexOf($("body").data("user"))>0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a)),c.indexOf("/admin/application_user/profile")>=0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a))}};$(function(){uploader.init(),shortcut.init(),$(".scrollDiv").hover(function(){$(this).addClass("on"),iframe.need_focus=!1},function(){$(this).removeClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseleave(function(){$(this).removeClass("on")}),$(".enter-sorting-mode").click(function(){view.change("sort")}),$(".enter-view-mode").click(function(){view.change("view")}),$(".enter-edit-mode").click(function(){view.change("edit")}),$(".enter-delete-mode").click(function(){view.change("delete")}),$(".page-overlay").click(function(){$("div.search-bar, .page-overlay").removeClass("on"),$("body").removeClass("on-search")}),$("#keyword").focus(function(){ui.closeMessageBox(),$("div.search-bar, .page-overlay").addClass("on"),$("body").addClass("on-search")}).keyup(function(a){13==a.which&&(a.preventDefault(),iframe.search($(this).val()))}),$(".menu-link").click(function(a){var b=$(this).attr("href");$(b).hasClass("in")?(a.stopPropagation(),a.preventDefault(),$(b).removeClass("in").animate({left:-300},function(){}),$("#main-nav").show().animate({left:0})):(a.stopPropagation(),a.preventDefault(),$("#main-nav").animate({left:-300},function(){$(this).hide()}),$(b).animate({left:0},function(){$(b).addClass("in")}))})});var progress_bar={dom:$(".progress-bar"),set:function(a){setTimeout(function(){progress_bar.dom.width(a+"%")},0),100==a&&setTimeout(function(){progress_bar.dom.width(0)},2500)}},affix=function(a){a>=25?$("header.header").addClass("affix"):$("header.header").removeClass("affix")},consoleDOD=function(a){a.preventDefault(),a.stopPropagation(),iframe.focus()},message={list:[],snackbarText:1,quick_show:function(a,b){void 0!==b?swal({title:"",html:a,timer:b,showConfirmButton:!1}).done():swal(a).done()},quick_info:function(a,b){$("body").snackbar({alive:b,content:a,show:function(){message.snackbarText++}})},showAll:function(a){$(a).find(".alert").each(function(){var a="info",b=$(this);b.hasClass("alert-info")&&(a="info"),b.hasClass("alert-warning")&&(a="warning"),b.hasClass("alert-success")&&(a="success"),b.hasClass("alert-danger")&&(a="danger"),message.insert(a,b.data("title"),b.html(),b.data("image"))})},ui:{show:function(a){$(".alert-moment").each(function(){var a=$(this).data("create");$(this).text(moment(a).fromNow())}),$(".msg").length>25&&$(".msg").last().remove(),void 0!=a&&1==a&&(clearTimeout(message.ui.hideTimer),message.ui.hideTimerCount=5,message.ui.hideAuto())},hideAuto:function(){message.ui.hideTimerCount=parseInt(message.ui.hideTimerCount)-1,message.ui.hideTimerCount<=0?message.ui.hide():message.ui.hideTimer=setTimeout(message.ui.hideAuto,1e3)},hide:function(){$("#message-box").parent("li").removeClass("open"),message.ui.hideTimerCount=0}},insert:function(a,b,c,d,e){var f=getRandID("message-");return void 0!=c&&""!=c&&message.list.push({kind:a,title:b,text:c,image:d,message_id:f,mini:e}),f},change:function(a,b,c,d,e,f){message.list.push({kind:b,title:c,text:d,image:e,message_id:a,mini:f})},afterInsert:function(){if(message.list.length>0){var a=message.list.pop();if(void 0!=a&&""!=a.text){var b="",c="",d="";switch(a.kind){case"info":c='<i class="glyphicon glyphicon-bullhorn"></i>',b="訊息";break;case"warning":c='<i class="glyphicon glyphicon-bell"></i>',b="注意";break;case"danger":c='<i class="glyphicon glyphicon-info-sign"></i>',b="錯誤";break;case"success":c='<i class="glyphicon glyphicon-ok"></i>',b="成功"}void 0!=a.image&&""!=a.image?(c='<i class="glyphicon"></i>',d="url("+a.image+")"):d="none",void 0!=a.title&&""!=a.title&&(b=a.title);var e="#"+a.message_id;if(0==$(e).length){var f='<a class="tile waves-attach" id="'+a.message_id+'" href="javascript:void(0)"><div class="tile-side pull-left"><div class="avatar avatar-sm"><div class="alert-tag" style="background-size: cover;"></div></div></div><div class="tile-inner text-black"><span class="alert-moment"></span><span class="alert-title"></span><span class="alert-text"></span></div></a>';$("#message-box").prepend(f)}$(e).find(".alert-tag").html(c).removeClass("alert-info alert-warning alert-danger alert-success").addClass("alert-"+a.kind).css("background-image",d),$(e).find(".alert-moment").data("create",moment().format()),$(e).find(".alert-title").text(b),$(e).find(".alert-text").html(a.text),$("#message-count").text($("#message-box li").length-1);var g=!1;void 0!=a.mini&&1==a.mini&&(g=a.mini),0==g&&message.ui.show(!0)}}}};Object.defineProperty(message.list,"push",{configurable:!1,enumerable:!1,writable:!1,value:function(){for(var a=0,b=this.length,c=arguments.length;a<c;a++,b++)this[b]=arguments[a],message.afterInsert();return b}});var uploader={init:function(){$(document).on("change","#image-file-picker",function(){uploader.startUpload()})},pickup_target:null,pickup_target_is_editor:!1,pickup:function(a,b){uploader.pickup_target=a,uploader.pickup_target_is_editor=b,a.hasClass("image")?$("#image-file-picker").attr("accept","image/*"):$("#image-file-picker").attr("accept","*"),$("#image-file-picker").click()},startUpload:function(){var a=document.getElementById("image-file-picker"),b=a.files[0];uploader.addFile(b,uploader.pickup_target,function(a){var b=a.response.url,c=a.response.item.__key__;uploader.pickup_target_is_editor?uploader.pickup_target.selection.setContent('<img src="'+b+'" />'):uploader.pickup_target.val(b).data("key",c).change(),$("#image-file-picker").val("")})},addFile:function(a,b,c){progress_bar.set(10);var d=message.insert("info","準備上傳","等待中....",void 0,!0);json_async("/admin/user_file/get.json",null,function(e){progress_bar.set(20),uploader.upload({message_id:d,upload_url:e.url,file:a,target_id:b,callback:c})},function(a){progress_bar.set(0),message.change(d,"danger","發生錯誤","無法取得上傳的路徑，請稍候再試一次")})},upload:function(upload_target){var reader=new FileReader;reader.reader_info=upload_target,reader.readAsDataURL(upload_target.file),reader.onload=function(e){this.reader_info.image=this.result,progress_bar.set(30),message.change(this.reader_info.message_id,"info","正在上傳","等待中....",this.reader_info.image,!0);var fd=new FormData,xhr=new XMLHttpRequest;xhr.xhr_info=this.reader_info,xhr.upload.upload_info=this.reader_info,xhr.open("POST",this.reader_info.upload_url),xhr.onload=function(data){progress_bar.set(100),message.quick_info("上傳完成"),message.change(this.xhr_info.message_id,"success","上傳完成","100 %, 上傳完成",this.xhr_info.image,!0),"function"==typeof this.xhr_info.callback&&(eval("var a = "+data.currentTarget.response),this.xhr_info.callback({response:a,target_id:this.xhr_info.target_id}))},xhr.onerror=function(a){message.change(this.xhr_info.message_id,"danger","上傳失敗","請重整頁面後再試一次",this.xhr_info.image,!0),progress_bar.set(0)},xhr.upload.onprogress=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100|0;100==b&&(b=99.9);var c=this;setTimeout(function(){message.change(c.upload_info.message_id,"info","正在上傳",b+" %",c.upload_info.image,!0)},0),progress_bar.set(b)}},fd.append("name",this.reader_info.file.name),fd.append("content_type",this.reader_info.file.type),fd.append("file",this.reader_info.file),xhr.send(fd)},/image\/\w+/.test(upload_target.file.type)}},iframe={instance:null,history:{},last_url:null,need_focus:!1,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){if(!this.is_init){this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("iframe"),window.onpopstate=this.popState,this.history=JSON.parse(localStorage.getItem("iframe.history")),null!=this.history&&"null"!=this.history||(this.history=[]);var b=$("a[target=content_iframe]");b.click(function(a){var b=$(this).find(".icon").text()?$(this).find(".icon").length>0:"",c=$(this).text().replace(b,"").trim();$(this).hasClass("main-link")&&aside.closeUi(),iframe.load($(this).attr("href"),c),a.preventDefault()});var c=$("body").data("dashboard-name");if(window.location.hash){var d=!1,e=window.location.hash.replace("#","");if(b.each(function(){$(this).attr("href")==e&&(d=!0,$(this).click())}),0==d){var f=this.getState(e);if(null!=f)iframe.load(e,f.text,f.referer_page);else{var g=e.split("/").slice(0,3).join("/");b.each(function(){$(this).attr("href")==g&&(d=!0,$(this).click())})}}0==d&&iframe.load("/"+c+"/welcome","Welcome")}else iframe.load("/"+c+"/welcome","Welcome");$(".content").hover(function(){},function(){setTimeout(function(){0==iframe.need_focus&&$(".iframe_mask").show()},800)}),$(".iframe_mask").hover(iframe.focus,function(){iframe.need_focus=!1}).mouseover(iframe.focus).mouseenter(iframe.focus).click(iframe.focus)}},focus:function(){$(".iframe_mask").hide(),iframe.need_focus=!0,iframe.instance.contentWindow.focus();var a=null;try{a=$(this.instance).contents()}catch(b){a=this.instance.contents()}a.find("body").click()},removeMask:function(){iframe.need_focus=!0,$(".iframe_mask").hide()},reload:function(a){a&&1==a||aside.closeUi();var b=this.getState();null!=b&&iframe.load(b.href,b.text,b.referer_page)},getUrl:function(){return this.last_url},load:function(a,b,c){return affix(0),1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){iframe.instance.contentWindow.showTimeout()},25e3),this.last_url=a,this.pushState(a,b,c),void iframe.instance.contentWindow.showLoading(function(){ajax(a,null,function(a){var b=iframe.getState();b&&history.pushState(b,b.text,"#"+b.href),clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a)},function(a){return clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a),!1},{is_ajax:"true"})}))},addClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").addClass(a)},removeClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").removeClass(a)},getState:function(a){return"undefined"==typeof a&&(a=iframe.getUrl()),a in this.history?iframe.history[a]:null},pushState:function(a,b,c){var d=this.getState(c);d&&d.referer_page&&(c=d.referer_page);var e=null;return a in this.history?(e=iframe.history[a],e.last_date=Date.now(),e.visit?e.visit++:e.visit=1,localStorage.setItem("iframe.history",JSON.stringify(this.history)),!1):(this.history[a]={href:a,text:b,visit:1,last_date:Date.now(),referer_page:c},void localStorage.setItem("iframe.history",JSON.stringify(this.history)))},popState:function(a){var b=a.state;b&&(iframe.load(b.href,b.text,b.is_list),window.history.replaceState(b,b.text,"#"+b.href))},search:function(a){var b="",c=this.last_url;void 0!=a&&""!=a&&(b=replaceParam(c,"query",a),b=replaceParam(b,"cursor",""),b=b.replace("?cursor=none","?"),b=b.replace("&cursor=none",""),this.load(b)),""==a&&(b=replaceParam(c,"query",""),b=b.replace("query=",""),this.load(b))}},aside={instance:null,is_open:!1,last_url:null,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){this.is_init||(this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("aside"),$(window).resize(function(){$("#aside_iframe.open").stop().animate({width:$(window).width()<992?"100%":"52%"},200)}))},load:function(a){return 1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){aside.loading_lock=!1,aside.instance.contentWindow.showTimeout()},25e4),this.last_url=a,void(this.is_open?aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}):(aside.showUi(),aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}))))},reload:function(){this.load(this.last_url)},runAjax:function(a){var b={is_ajax:"true",aside:"aside"};ajax(a,null,function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},b)},showUi:function(a){$("#aside_iframe").stop().animate({width:$(window).width()<992?"100%":"52%"},500,function(){aside.is_open=!0,"function"==typeof a&&a(),$(this).addClass("open")})},closeUi:function(a){$("#aside_iframe").stop().animate({width:"0"},500,function(){aside.is_open=!1,"function"==typeof a&&a(),$(this).removeClass("open")})}},shortcut={keys:"ctrl+r, `, ctrl+s, ctrl+shift+s, ctrl+p, esc, f5, ctrl+f5, alt+s, alt+1, alt+2, alt+3, alt+4, alt+5, alt+6, alt+7, alt+8, alt+9, /, shift+/",timer:null,lock:!1,init:function(){var a=[],b=1;$(".op-mode a").each(function(){a.push($(this).data("view-key")),a.push(b.toString()),b++}),shortcut.keys+=", "+a.join(", "),console.log(shortcut.keys),key.filter=function(a){var b=(a.target||a.srcElement).tagName;return key.setScope(/^(INPUT|TEXTAREA|SELECT)$/.test(b)?"input":"doc"),!0},key(shortcut.keys,"doc",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)}),key(shortcut.keys,"input",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)})},catchEvent:function(a,b,c){var d=aside.is_open?aside:iframe,e=d.instance.contentWindow;switch(console.log(a,b,c),b){case"ctrl+p":e.print();break;case"f5":case"ctrl+r":case"ctrl+f5":d.reload()}if(aside.is_open)switch(b){case"ctrl+shift+s":e.save_and_exit();break;case"ctrl+s":e.save_form();break;case"alt+1":case"alt+2":case"alt+3":case"alt+4":case"alt+5":case"alt+6":case"alt+7":case"alt+8":case"alt+9":e.change_lang(parseInt(b.replace("alt+",""))-1)}if("input"!=c){var f=1;switch($(".op-mode a").each(function(){b!=$(this).data("view-key")&&b!=f.toString()||view.change($(this).data("view")),f++}),b){case"/":return ui.showSearchBox(),!1;case"shift+/":console.log("help");break;case"alt+s":$("body").toggleClass("sortTag");break;case"`":aside.is_open?aside.closeUi():aside.showUi();break;case"esc":if(1==shortcut.lock)return shortcut.lock=!1,aside.closeUi(),!1;shortcut.lock=!0,clearTimeout(shortcut.timer),shortcut.timer=setTimeout(function(){shortcut.lock=!1},400)}}if("input"==c)switch(b){case"esc":return ui.closeSearchBox(),!1}if(jQuery.inArray(b,["ctrl+shift+s","ctrl+s","ctrl+r","ctrl+f5","f5","ctrl+p"])>-1)return!1}},view={current:"edit",change:function(a){""==window.name&&(this.current=a,$("body").removeClass("in-view-mode").removeClass("in-edit-mode").removeClass("in-delete-mode").removeClass("in-sort-mode").addClass("in-"+a+"-mode"),"sort"==a?iframe.addClass("in-sort-mode"):iframe.removeClass("in-sort-mode"),iframe.instance.contentWindow.changeView(),aside.is_open&&aside.instance.contentWindow.changeViewAndReload())}},ui={closeMessageBox:function(){$("header").click()},showSearchBox:function(){$("#keyword").click().focus()},closeSearchBox:function(){$(".page-overlay a").focus(),$(".page-overlay").click()},setUserInformation:function(a,b){var c=iframe.last_url;c.indexOf("/admin/application_user/%3A")>=0&&c.indexOf($("body").data("user"))>0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a)),c.indexOf("/admin/application_user/profile")>=0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a))}};$(function(){uploader.init(),shortcut.init(),$(".scrollDiv").hover(function(){$(this).addClass("on"),iframe.need_focus=!1},function(){$(this).removeClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseleave(function(){$(this).removeClass("on")}),$(".enter-sorting-mode").click(function(){view.change("sort")}),$(".enter-view-mode").click(function(){view.change("view")}),$(".enter-edit-mode").click(function(){view.change("edit")}),$(".enter-delete-mode").click(function(){view.change("delete")}),$(".page-overlay").click(function(){$("div.search-bar, .page-overlay").removeClass("on"),$("body").removeClass("on-search")}),$("#keyword").focus(function(){ui.closeMessageBox(),$("div.search-bar, .page-overlay").addClass("on"),$("body").addClass("on-search")}).keyup(function(a){13==a.which&&(a.preventDefault(),iframe.search($(this).val()))}),$(".menu-link").click(function(a){var b=$(this).attr("href");$(b).hasClass("in")?(a.stopPropagation(),a.preventDefault(),$(b).removeClass("in").animate({left:-300},function(){}),$("#main-nav").show().animate({left:0})):(a.stopPropagation(),a.preventDefault(),$("#main-nav").animate({left:-300},function(){$(this).hide()}),$(b).animate({left:0},function(){$(b).addClass("in")}))})});var progress_bar={dom:$(".progress-bar"),set:function(a){setTimeout(function(){progress_bar.dom.width(a+"%")},0),100==a&&setTimeout(function(){progress_bar.dom.width(0)},2500)}},affix=function(a){a>=25?$("header.header").addClass("affix"):$("header.header").removeClass("affix")},consoleDOD=function(a){a.preventDefault(),a.stopPropagation(),iframe.focus()},message={list:[],snackbarText:1,quick_show:function(a,b){void 0!==b?swal({title:"",html:a,timer:b,showConfirmButton:!1}).done():swal(a).done()},quick_info:function(a,b){$("body").snackbar({alive:b,content:a,show:function(){message.snackbarText++}})},showAll:function(a){$(a).find(".alert").each(function(){var a="info",b=$(this);b.hasClass("alert-info")&&(a="info"),b.hasClass("alert-warning")&&(a="warning"),b.hasClass("alert-success")&&(a="success"),b.hasClass("alert-danger")&&(a="danger"),message.insert(a,b.data("title"),b.html(),b.data("image"))})},ui:{show:function(a){$(".alert-moment").each(function(){var a=$(this).data("create");$(this).text(moment(a).fromNow())}),$(".msg").length>25&&$(".msg").last().remove(),void 0!=a&&1==a&&(clearTimeout(message.ui.hideTimer),message.ui.hideTimerCount=5,message.ui.hideAuto())},hideAuto:function(){message.ui.hideTimerCount=parseInt(message.ui.hideTimerCount)-1,message.ui.hideTimerCount<=0?message.ui.hide():message.ui.hideTimer=setTimeout(message.ui.hideAuto,1e3)},hide:function(){$("#message-box").parent("li").removeClass("open"),message.ui.hideTimerCount=0}},insert:function(a,b,c,d,e){var f=getRandID("message-");return void 0!=c&&""!=c&&message.list.push({kind:a,title:b,text:c,image:d,message_id:f,mini:e}),f},change:function(a,b,c,d,e,f){message.list.push({kind:b,title:c,text:d,image:e,message_id:a,mini:f})},afterInsert:function(){if(message.list.length>0){var a=message.list.pop();if(void 0!=a&&""!=a.text){var b="",c="",d="";switch(a.kind){case"info":c='<i class="glyphicon glyphicon-bullhorn"></i>',b="訊息";break;case"warning":c='<i class="glyphicon glyphicon-bell"></i>',b="注意";break;case"danger":c='<i class="glyphicon glyphicon-info-sign"></i>',b="錯誤";break;case"success":c='<i class="glyphicon glyphicon-ok"></i>',b="成功"}void 0!=a.image&&""!=a.image?(c='<i class="glyphicon"></i>',d="url("+a.image+")"):d="none",void 0!=a.title&&""!=a.title&&(b=a.title);var e="#"+a.message_id;if(0==$(e).length){var f='<a class="tile waves-attach" id="'+a.message_id+'" href="javascript:void(0)"><div class="tile-side pull-left"><div class="avatar avatar-sm"><div class="alert-tag" style="background-size: cover;"></div></div></div><div class="tile-inner text-black"><span class="alert-moment"></span><span class="alert-title"></span><span class="alert-text"></span></div></a>';$("#message-box").prepend(f)}$(e).find(".alert-tag").html(c).removeClass("alert-info alert-warning alert-danger alert-success").addClass("alert-"+a.kind).css("background-image",d),$(e).find(".alert-moment").data("create",moment().format()),$(e).find(".alert-title").text(b),$(e).find(".alert-text").html(a.text),$("#message-count").text($("#message-box li").length-1);var g=!1;void 0!=a.mini&&1==a.mini&&(g=a.mini),0==g&&message.ui.show(!0)}}}};Object.defineProperty(message.list,"push",{configurable:!1,enumerable:!1,writable:!1,value:function(){for(var a=0,b=this.length,c=arguments.length;a<c;a++,b++)this[b]=arguments[a],message.afterInsert();return b}});var uploader={init:function(){$(document).on("change","#image-file-picker",function(){uploader.startUpload()})},pickup_target:null,pickup_target_is_editor:!1,pickup:function(a,b){uploader.pickup_target=a,uploader.pickup_target_is_editor=b,a.hasClass("image")?$("#image-file-picker").attr("accept","image/*"):$("#image-file-picker").attr("accept","*"),$("#image-file-picker").click()},startUpload:function(){var a=document.getElementById("image-file-picker"),b=a.files[0];uploader.addFile(b,uploader.pickup_target,function(a){var b=a.response.url,c=a.response.item.__key__;uploader.pickup_target_is_editor?uploader.pickup_target.selection.setContent('<img src="'+b+'" />'):uploader.pickup_target.val(b).data("key",c).change(),$("#image-file-picker").val("")})},addFile:function(a,b,c){progress_bar.set(10);var d=message.insert("info","準備上傳","等待中....",void 0,!0);json_async("/admin/user_file/get.json",null,function(e){progress_bar.set(20),uploader.upload({message_id:d,upload_url:e.url,file:a,target_id:b,callback:c})},function(a){progress_bar.set(0),message.change(d,"danger","發生錯誤","無法取得上傳的路徑，請稍候再試一次")})},upload:function(upload_target){var reader=new FileReader;reader.reader_info=upload_target,reader.readAsDataURL(upload_target.file),reader.onload=function(e){this.reader_info.image=this.result,progress_bar.set(30),message.change(this.reader_info.message_id,"info","正在上傳","等待中....",this.reader_info.image,!0);var fd=new FormData,xhr=new XMLHttpRequest;xhr.xhr_info=this.reader_info,xhr.upload.upload_info=this.reader_info,xhr.open("POST",this.reader_info.upload_url),xhr.onload=function(data){progress_bar.set(100),message.quick_info("上傳完成"),message.change(this.xhr_info.message_id,"success","上傳完成","100 %, 上傳完成",this.xhr_info.image,!0),"function"==typeof this.xhr_info.callback&&(eval("var a = "+data.currentTarget.response),this.xhr_info.callback({response:a,target_id:this.xhr_info.target_id}))},xhr.onerror=function(a){message.change(this.xhr_info.message_id,"danger","上傳失敗","請重整頁面後再試一次",this.xhr_info.image,!0),progress_bar.set(0)},xhr.upload.onprogress=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100|0;100==b&&(b=99.9);var c=this;setTimeout(function(){message.change(c.upload_info.message_id,"info","正在上傳",b+" %",c.upload_info.image,!0)},0),progress_bar.set(b)}},fd.append("name",this.reader_info.file.name),fd.append("content_type",this.reader_info.file.type),fd.append("file",this.reader_info.file),xhr.send(fd)},/image\/\w+/.test(upload_target.file.type)}},iframe={instance:null,history:{},last_url:null,need_focus:!1,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){if(!this.is_init){this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("iframe"),window.onpopstate=this.popState,this.history=JSON.parse(localStorage.getItem("iframe.history")),null!=this.history&&"null"!=this.history||(this.history=[]);var b=$("a[target=content_iframe]");b.click(function(a){var b=$(this).find(".icon").text()?$(this).find(".icon").length>0:"",c=$(this).text().replace(b,"").trim();$(this).hasClass("main-link")&&aside.closeUi(),iframe.load($(this).attr("href"),c),a.preventDefault()});var c=$("body").data("dashboard-name");if(window.location.hash){var d=!1,e=window.location.hash.replace("#","");if(b.each(function(){$(this).attr("href")==e&&(d=!0,$(this).click())}),0==d){var f=this.getState(e);if(null!=f)iframe.load(e,f.text,f.referer_page);else{var g=e.split("/").slice(0,3).join("/");b.each(function(){$(this).attr("href")==g&&(d=!0,$(this).click())})}}0==d&&iframe.load("/"+c+"/welcome","Welcome")}else iframe.load("/"+c+"/welcome","Welcome");$(".content").hover(function(){},function(){setTimeout(function(){0==iframe.need_focus&&$(".iframe_mask").show()},800)}),$(".iframe_mask").hover(iframe.focus,function(){iframe.need_focus=!1}).mouseover(iframe.focus).mouseenter(iframe.focus).click(iframe.focus)}},focus:function(){$(".iframe_mask").hide(),iframe.need_focus=!0,iframe.instance.contentWindow.focus();var a=null;try{a=$(this.instance).contents()}catch(b){a=this.instance.contents()}a.find("body").click()},removeMask:function(){iframe.need_focus=!0,$(".iframe_mask").hide()},reload:function(a){a&&1==a||aside.closeUi();var b=this.getState();null!=b&&iframe.load(b.href,b.text,b.referer_page)},getUrl:function(){return this.last_url},load:function(a,b,c){return affix(0),1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){iframe.instance.contentWindow.showTimeout()},25e3),this.last_url=a,this.pushState(a,b,c),void iframe.instance.contentWindow.showLoading(function(){ajax(a,null,function(a){var b=iframe.getState();b&&history.pushState(b,b.text,"#"+b.href),clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a)},function(a){return clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a),!1},{is_ajax:"true"})}))},addClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").addClass(a)},removeClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").removeClass(a)},getState:function(a){return"undefined"==typeof a&&(a=iframe.getUrl()),a in this.history?iframe.history[a]:null},pushState:function(a,b,c){var d=this.getState(c);d&&d.referer_page&&(c=d.referer_page);var e=null;return a in this.history?(e=iframe.history[a],e.last_date=Date.now(),e.visit?e.visit++:e.visit=1,localStorage.setItem("iframe.history",JSON.stringify(this.history)),!1):(this.history[a]={href:a,text:b,visit:1,last_date:Date.now(),referer_page:c},void localStorage.setItem("iframe.history",JSON.stringify(this.history)))},popState:function(a){var b=a.state;b&&(iframe.load(b.href,b.text,b.is_list),window.history.replaceState(b,b.text,"#"+b.href))},search:function(a){var b="",c=this.last_url;void 0!=a&&""!=a&&(b=replaceParam(c,"query",a),b=replaceParam(b,"cursor",""),b=b.replace("?cursor=none","?"),b=b.replace("&cursor=none",""),this.load(b)),""==a&&(b=replaceParam(c,"query",""),b=b.replace("query=",""),this.load(b))}},aside={instance:null,is_open:!1,last_url:null,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){this.is_init||(this.is_init=!0,this.instance=$(a).get(0),this.instance.contentWindow.setBodyClass("aside"),$(window).resize(function(){$("#aside_iframe.open").stop().animate({width:$(window).width()<992?"100%":"52%"},200)}))},load:function(a){return 1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){aside.loading_lock=!1,aside.instance.contentWindow.showTimeout()},25e4),this.last_url=a,void(this.is_open?aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}):(aside.showUi(),aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}))))},reload:function(){this.load(this.last_url)},runAjax:function(a){var b={is_ajax:"true",aside:"aside"};ajax(a,null,function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},b)},showUi:function(a){$("#aside_iframe").stop().animate({width:$(window).width()<992?"100%":"52%"},500,function(){aside.is_open=!0,"function"==typeof a&&a(),$(this).addClass("open")})},closeUi:function(a){$("#aside_iframe").stop().animate({width:"0"},500,function(){aside.is_open=!1,"function"==typeof a&&a(),$(this).removeClass("open")})}},shortcut={keys:"ctrl+r, `, ctrl+s, ctrl+shift+s, ctrl+p, esc, f5, ctrl+f5, alt+s, alt+1, alt+2, alt+3, alt+4, alt+5, alt+6, alt+7, alt+8, alt+9, /, shift+/",timer:null,lock:!1,init:function(){var a=[],b=1;$(".op-mode a").each(function(){a.push($(this).data("view-key")),a.push(b.toString()),b++}),shortcut.keys+=", "+a.join(", "),console.log(shortcut.keys),key.filter=function(a){var b=(a.target||a.srcElement).tagName;return key.setScope(/^(INPUT|TEXTAREA|SELECT)$/.test(b)?"input":"doc"),!0},key(shortcut.keys,"doc",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)}),key(shortcut.keys,"input",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)})},catchEvent:function(a,b,c){var d=aside.is_open?aside:iframe,e=d.instance.contentWindow;switch(console.log(a,b,c),b){case"ctrl+p":e.print();break;case"f5":case"ctrl+r":case"ctrl+f5":d.reload()}if(aside.is_open)switch(b){case"ctrl+shift+s":e.save_and_exit();break;case"ctrl+s":e.save_form();break;case"alt+1":case"alt+2":case"alt+3":case"alt+4":case"alt+5":case"alt+6":case"alt+7":case"alt+8":case"alt+9":e.change_lang(parseInt(b.replace("alt+",""))-1)}if("input"!=c){var f=1;switch($(".op-mode a").each(function(){b!=$(this).data("view-key")&&b!=f.toString()||view.change($(this).data("view")),f++}),b){case"/":return ui.showSearchBox(),!1;case"shift+/":console.log("help");break;case"alt+s":$("body").toggleClass("sortTag");break;case"`":aside.is_open?aside.closeUi():aside.showUi();break;case"esc":if(1==shortcut.lock)return shortcut.lock=!1,aside.closeUi(),!1;shortcut.lock=!0,clearTimeout(shortcut.timer),shortcut.timer=setTimeout(function(){shortcut.lock=!1},400)}}if("input"==c)switch(b){case"esc":
return ui.closeSearchBox(),!1}if(jQuery.inArray(b,["ctrl+shift+s","ctrl+s","ctrl+r","ctrl+f5","f5","ctrl+p"])>-1)return!1}},view={current:"edit",change:function(a){""==window.name&&(this.current=a,$("body").removeClass("in-view-mode").removeClass("in-edit-mode").removeClass("in-delete-mode").removeClass("in-sort-mode").addClass("in-"+a+"-mode"),"sort"==a?iframe.addClass("in-sort-mode"):iframe.removeClass("in-sort-mode"),iframe.instance.contentWindow.changeView(),aside.is_open&&aside.instance.contentWindow.changeViewAndReload())}},ui={closeMessageBox:function(){$("header").click()},showSearchBox:function(){$("#keyword").click().focus()},closeSearchBox:function(){$(".page-overlay a").focus(),$(".page-overlay").click()},setUserInformation:function(a,b){var c=iframe.last_url;c.indexOf("/admin/application_user/%3A")>=0&&c.indexOf($("body").data("user"))>0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a)),c.indexOf("/admin/application_user/profile")>=0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a))}};$(function(){uploader.init(),shortcut.init(),$(".scrollDiv").hover(function(){$(this).addClass("on"),iframe.need_focus=!1},function(){$(this).removeClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseleave(function(){$(this).removeClass("on")}),$(".enter-sorting-mode").click(function(){view.change("sort")}),$(".enter-view-mode").click(function(){view.change("view")}),$(".enter-edit-mode").click(function(){view.change("edit")}),$(".enter-delete-mode").click(function(){view.change("delete")}),$(".page-overlay").click(function(){$("div.search-bar, .page-overlay").removeClass("on"),$("body").removeClass("on-search")}),$("#keyword").focus(function(){ui.closeMessageBox(),$("div.search-bar, .page-overlay").addClass("on"),$("body").addClass("on-search")}).keyup(function(a){13==a.which&&(a.preventDefault(),iframe.search($(this).val()))}),$(".menu-link").click(function(a){var b=$(this).attr("href");$(b).hasClass("in")?(a.stopPropagation(),a.preventDefault(),$(b).removeClass("in").animate({left:-300},function(){}),$("#main-nav").show().animate({left:0})):(a.stopPropagation(),a.preventDefault(),$("#main-nav").animate({left:-300},function(){$(this).hide()}),$(b).animate({left:0},function(){$(b).addClass("in")}))})});var progress_bar={dom:$(".progress-bar"),set:function(a){setTimeout(function(){progress_bar.dom.width(a+"%")},0),100==a&&setTimeout(function(){progress_bar.dom.width(0)},2500)}},consoleDOD=function(a){a.preventDefault(),a.stopPropagation(),iframe.focus()},message={list:[],snackbarText:1,quick_show:function(a,b){void 0!==b?swal({title:a,html:a,timer:b,showConfirmButton:!1}).done():swal(a).done()},quick_info:function(a,b){$("body").snackbar({alive:b,content:a,show:function(){message.snackbarText++}})},showAll:function(a){$(a).find(".alert").each(function(){var a="info",b=$(this);b.hasClass("alert-info")&&(a="info"),b.hasClass("alert-warning")&&(a="warning"),b.hasClass("alert-success")&&(a="success"),b.hasClass("alert-danger")&&(a="danger"),message.insert(a,b.data("title"),b.html(),b.data("image"))})},ui:{show:function(a){$(".alert-moment").each(function(){var a=$(this).data("create");$(this).text(moment(a).fromNow())}),$(".msg").length>25&&$(".msg").last().remove(),void 0!=a&&1==a&&(clearTimeout(message.ui.hideTimer),message.ui.hideTimerCount=5,message.ui.hideAuto())},hideAuto:function(){message.ui.hideTimerCount=parseInt(message.ui.hideTimerCount)-1,message.ui.hideTimerCount<=0?message.ui.hide():message.ui.hideTimer=setTimeout(message.ui.hideAuto,1e3)},hide:function(){$("#message-box").parent("li").removeClass("open"),message.ui.hideTimerCount=0}},insert:function(a,b,c,d,e){var f=getRandID("message-");return void 0!=c&&""!=c&&message.list.push({kind:a,title:b,text:c,image:d,message_id:f,mini:e}),f},change:function(a,b,c,d,e,f){message.list.push({kind:b,title:c,text:d,image:e,message_id:a,mini:f})},afterInsert:function(){if(message.list.length>0){var a=message.list.pop();if(void 0!=a&&""!=a.text){var b="",c="",d="";switch(a.kind){case"info":c='<i class="glyphicon glyphicon-bullhorn"></i>',b="訊息";break;case"warning":c='<i class="glyphicon glyphicon-bell"></i>',b="注意";break;case"danger":c='<i class="glyphicon glyphicon-info-sign"></i>',b="錯誤";break;case"success":c='<i class="glyphicon glyphicon-ok"></i>',b="成功"}void 0!=a.image&&""!=a.image?(c='<i class="glyphicon"></i>',d="url("+a.image+")"):d="none",void 0!=a.title&&""!=a.title&&(b=a.title);var e="#"+a.message_id;if(0==$(e).length){var f='<a class="tile waves-attach" id="'+a.message_id+'" href="javascript:void(0)"><div class="tile-side pull-left"><div class="avatar avatar-sm"><div class="alert-tag" style="background-size: cover;"></div></div></div><div class="tile-inner text-black"><span class="alert-moment"></span><span class="alert-title"></span><span class="alert-text"></span></div></a>';$("#message-box").prepend(f)}$(e).find(".alert-tag").html(c).removeClass("alert-info alert-warning alert-danger alert-success").addClass("alert-"+a.kind).css("background-image",d),$(e).find(".alert-moment").data("create",moment().format()),$(e).find(".alert-title").text(b),$(e).find(".alert-text").html(a.text),$("#message-count").text($("#message-box li").length-1);var g=!1;void 0!=a.mini&&1==a.mini&&(g=a.mini),0==g&&message.ui.show(!0)}}}};Object.defineProperty(message.list,"push",{configurable:!1,enumerable:!1,writable:!1,value:function(){for(var a=0,b=this.length,c=arguments.length;a<c;a++,b++)this[b]=arguments[a],message.afterInsert();return b}});var uploader={init:function(){$(document).on("change","#image-file-picker",function(){uploader.startUpload()})},pickup_target:null,pickup_target_is_editor:!1,pickup:function(a,b){uploader.pickup_target=a,uploader.pickup_target_is_editor=b,$("#image-file-picker").click()},startUpload:function(){var a=document.getElementById("image-file-picker"),b=a.files[0];uploader.addFile(b,uploader.pickup_target,function(a){var b=a.response.url;uploader.pickup_target_is_editor?uploader.pickup_target.selection.setContent('<img src="'+b+'" />'):uploader.pickup_target.val(b).change()})},addFile:function(a,b,c){progress_bar.set(10);var d=message.insert("info","準備上傳","等待中....",void 0,!0);json_async("/admin/user_file/get.json",null,function(e){progress_bar.set(20),uploader.upload({message_id:d,upload_url:e.url,file:a,target_id:b,callback:c})},function(a){progress_bar.set(0),message.change(d,"danger","發生錯誤","無法取得上傳的路徑，請稍候再試一次")})},upload:function(upload_target){var reader=new FileReader;reader.reader_info=upload_target,reader.readAsDataURL(upload_target.file),reader.onload=function(e){this.reader_info.image=this.result,progress_bar.set(30),message.change(this.reader_info.message_id,"info","正在上傳","等待中....",this.reader_info.image,!0);var fd=new FormData,xhr=new XMLHttpRequest;xhr.xhr_info=this.reader_info,xhr.upload.upload_info=this.reader_info,xhr.open("POST",this.reader_info.upload_url),xhr.onload=function(data){progress_bar.set(100),message.quick_info("上傳完成"),message.change(this.xhr_info.message_id,"success","上傳完成","100 %, 上傳完成",this.xhr_info.image,!0),"function"==typeof this.xhr_info.callback&&(eval("var a = "+data.currentTarget.response),this.xhr_info.callback({response:a,target_id:this.xhr_info.target_id}))},xhr.onerror=function(a){message.change(this.xhr_info.message_id,"danger","上傳失敗","請重整頁面後再試一次",this.xhr_info.image,!0),progress_bar.set(0)},xhr.upload.onprogress=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100|0;100==b&&(b=99.9);var c=this;setTimeout(function(){message.change(c.upload_info.message_id,"info","正在上傳",b+" %",c.upload_info.image,!0)},0),progress_bar.set(b)}},fd.append("file_name",this.reader_info.file.name),fd.append("file_type",this.reader_info.file.type),fd.append("file",this.reader_info.file),xhr.send(fd)},/image\/\w+/.test(upload_target.file.type)}},iframe={instance:null,history:{},last_url:null,need_focus:!1,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){if(!this.is_init){this.is_init=!0,this.instance=$(a).get(0),window.onpopstate=this.popState,this.history=JSON.parse(localStorage.getItem("iframe.history")),null!=this.history&&"null"!=this.history||(this.history=[]);var b=$("a[target=content_iframe]");b.click(function(a){var b=$(this).find(".icon").text()?$(this).find(".icon").length>0:"",c=$(this).text().replace(b,"").trim();$(this).hasClass("main-link")&&aside.closeUi(),iframe.load($(this).attr("href"),c),a.preventDefault()});var c=$("body").data("dashboard-name");if(window.location.hash){var d=!1,e=window.location.hash.replace("#","");if(b.each(function(){$(this).attr("href")==e&&(d=!0,$(this).click())}),0==d){var f=this.getState(e);if(null!=f)iframe.load(e,f.text,f.referer_page);else{var g=e.split("/").slice(0,3).join("/");b.each(function(){$(this).attr("href")==g&&(d=!0,$(this).click())})}}0==d&&iframe.load("/"+c+"/welcome","Welcome")}else iframe.load("/"+c+"/welcome","Welcome");$(".content").hover(function(){},function(){setTimeout(function(){0==iframe.need_focus&&$(".iframe_mask").show()},800)}),$(".iframe_mask").hover(iframe.focus,function(){iframe.need_focus=!1}).mouseover(iframe.focus).mouseenter(iframe.focus).click(iframe.focus)}},focus:function(){$(".iframe_mask").hide(),iframe.need_focus=!0,iframe.instance.contentWindow.focus();var a=null;try{a=$(this.instance).contents()}catch(b){a=this.instance.contents()}a.find("body").click()},removeMask:function(){iframe.need_focus=!0,$(".iframe_mask").hide()},reload:function(a){a&&1==a||aside.closeUi();var b=this.getState();null!=b&&iframe.load(b.href,b.text,b.referer_page)},getUrl:function(){return this.last_url},load:function(a,b,c){return 1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){iframe.instance.contentWindow.showTimeout()},25e3),this.last_url=a,this.pushState(a,b,c),void iframe.instance.contentWindow.showLoading(function(){ajax(a,null,function(a){var b=iframe.getState();b&&history.pushState(b,b.text,"#"+b.href),clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a)},function(a){return clearTimeout(iframe.loading_timer),iframe.loading_lock=!1,iframe.instance.contentWindow.pageInit(a),!1},{is_ajax:"true"})}))},addClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").addClass(a)},removeClass:function(a){var b=null;try{b=$(this.instance).contents()}catch(a){b=this.instance.contents()}b.find("body").removeClass(a)},getState:function(a){return"undefined"==typeof a&&(a=iframe.getUrl()),a in this.history?iframe.history[a]:null},pushState:function(a,b,c){var d=this.getState(c);d&&d.referer_page&&(c=d.referer_page);var e=null;return a in this.history?(e=iframe.history[a],e.last_date=Date.now(),e.visit?e.visit++:e.visit=1,localStorage.setItem("iframe.history",JSON.stringify(this.history)),!1):(this.history[a]={href:a,text:b,visit:1,last_date:Date.now(),referer_page:c},void localStorage.setItem("iframe.history",JSON.stringify(this.history)))},popState:function(a){var b=a.state;b&&(iframe.load(b.href,b.text,b.is_list),window.history.replaceState(b,b.text,"#"+b.href))},setPageTitle:function(a){$(".header-page-name").text(a)},search:function(a){var b="",c=this.last_url;void 0!=a&&""!=a&&(b=replaceParam(c,"query",a),b=replaceParam(b,"cursor",""),b=b.replace("?cursor=none","?"),b=b.replace("&cursor=none",""),this.load(b)),""==a&&(b=replaceParam(c,"query",""),b=b.replace("query=",""),this.load(b))}},aside={instance:null,is_open:!1,last_url:null,is_init:!1,loading_timer:null,loading_lock:!1,init:function(a){this.is_init||(this.is_init=!0,this.instance=$(a).get(0),$(window).resize(function(){$("#aside_iframe.open").stop().animate({width:$(window).width()<992?"100%":"52%"},200)}))},load:function(a){return 1!=this.loading_lock&&(this.loading_lock=!0,clearTimeout(this.loading_timer),this.loading_timer=setTimeout(function(){aside.loading_lock=!1,aside.instance.contentWindow.showTimeout()},25e4),this.last_url=a,void(this.is_open?aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}):(aside.showUi(),aside.instance.contentWindow.showLoading(function(){aside.runAjax(a)}))))},reload:function(){this.load(this.last_url)},runAjax:function(a){var b={is_ajax:"true",aside:"aside"};ajax(a,null,function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},function(a){clearTimeout(aside.loading_timer),aside.loading_lock=!1,aside.instance.contentWindow.pageInit(a)},b)},showUi:function(a){$("#aside_iframe").stop().animate({width:$(window).width()<992?"100%":"52%"},500,function(){aside.is_open=!0,"function"==typeof a&&a(),$(this).addClass("open")})},closeUi:function(a){$("#aside_iframe").stop().animate({width:"0"},500,function(){aside.is_open=!1,"function"==typeof a&&a(),$(this).removeClass("open")})}},shortcut={keys:"ctrl+r, `, ctrl+s, ctrl+shift+s, ctrl+p, esc, f5, ctrl+f5, alt+1, alt+2, alt+3, alt+4, alt+5, alt+6, alt+7, alt+8, alt+9, /, shift+/",timer:null,lock:!1,init:function(){var a=[],b=1;$(".op-mode a").each(function(){a.push($(this).data("view-key")),a.push(b.toString()),b++}),shortcut.keys+=", "+a.join(", "),console.log(shortcut.keys),key.filter=function(a){var b=(a.target||a.srcElement).tagName;return key.setScope(/^(INPUT|TEXTAREA|SELECT)$/.test(b)?"input":"doc"),!0},key(shortcut.keys,"doc",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)}),key(shortcut.keys,"input",function(a,b){return shortcut.catchEvent(window.name,b.shortcut,b.scope)})},catchEvent:function(a,b,c){var d=aside.is_open?aside:iframe,e=d.instance.contentWindow;switch(console.log(a,b,c),b){case"ctrl+p":e.print();break;case"f5":case"ctrl+r":case"ctrl+f5":d.reload()}if(aside.is_open)switch(b){case"ctrl+shift+s":e.save_and_exit();break;case"ctrl+s":e.save_form();break;case"alt+1":case"alt+2":case"alt+3":case"alt+4":case"alt+5":case"alt+6":case"alt+7":case"alt+8":case"alt+9":e.change_lang(parseInt(b.replace("alt+",""))-1)}if("input"!=c){var f=1;switch($(".op-mode a").each(function(){b!=$(this).data("view-key")&&b!=f.toString()||view.change($(this).data("view")),f++}),b){case"/":return ui.showSearchBox(),!1;case"shift+/":console.log("help");break;case"`":aside.is_open?aside.closeUi():aside.showUi();break;case"esc":if(1==shortcut.lock)return shortcut.lock=!1,aside.closeUi(),!1;shortcut.lock=!0,clearTimeout(shortcut.timer),shortcut.timer=setTimeout(function(){shortcut.lock=!1},400)}}if("input"==c)switch(b){case"esc":return ui.closeSearchBox(),!1}if(jQuery.inArray(b,["ctrl+shift+s","ctrl+s","ctrl+r","ctrl+f5","f5","ctrl+p"])>-1)return!1}},view={current:"edit",change:function(a){""==window.name&&(this.current=a,$("body").removeClass("in-view-mode").removeClass("in-edit-mode").removeClass("in-delete-mode").removeClass("in-sort-mode").addClass("in-"+a+"-mode"),"sort"==a?iframe.addClass("in-sort-mode"):iframe.removeClass("in-sort-mode"),aside.is_open&&aside.instance.contentWindow.changeView())}},ui={closeMessageBox:function(){$("header").click()},showSearchBox:function(){$("#keyword").click().focus()},closeSearchBox:function(){$(".page-overlay a").focus(),$(".page-overlay").click()},setUserInformation:function(a,b){var c=iframe.last_url;c.indexOf("/admin/application_user/%3A")>=0&&c.indexOf($("body").data("user"))>0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a)),c.indexOf("/admin/application_user/profile")>=0&&($(".user-box .avatar").css({"background-image":"url("+b+")"}),$(".user-name a").text(a))}};$(function(){uploader.init(),shortcut.init(),$(".scrollDiv").hover(function(){$(this).addClass("on"),iframe.need_focus=!1},function(){$(this).removeClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseover(function(){$(this).addClass("on")}).mouseleave(function(){$(this).removeClass("on")}),$(".enter-sorting-mode").click(function(){view.change("sort")}),$(".enter-view-mode").click(function(){view.change("view")}),$(".enter-edit-mode").click(function(){view.change("edit")}),$(".enter-delete-mode").click(function(){view.change("delete")}),$(".page-overlay").click(function(){$("div.search-bar, .page-overlay").removeClass("on")}),$("#keyword").focus(function(){ui.closeMessageBox(),$("div.search-bar, .page-overlay").addClass("on")}).keyup(function(a){13==a.which&&(a.preventDefault(),iframe.search($(this).val()))}),$(".menu-link").click(function(a){var b=$(this).attr("href");$(b).hasClass("in")?(a.stopPropagation(),a.preventDefault(),$(b).removeClass("in").animate({left:-300},function(){}),$("#main-nav").show().animate({left:0})):(a.stopPropagation(),a.preventDefault(),$("#main-nav").animate({left:-300},function(){$(this).hide()}),$(b).animate({left:0},function(){$(b).addClass("in")}))})});
//# sourceMappingURL=console.min.js.map